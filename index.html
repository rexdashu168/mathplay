<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è›¹çš„æ•¸å­¸æ˜Ÿçƒå†’éšª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');
        
        :root {
            --space-dark: #0F172A;
            --space-blue: #1E3A5F;
            --blue: #3B82F6;
            --purple: #8B5CF6;
            --purple-dark: #6D28D9;
            --cyan: #06B6D4;
            --orange: #F97316;
            --yellow: #FACC15;
            --green: #22C55E;
            --pink: #EC4899;
            --white: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            background: linear-gradient(180deg, 
                #0F172A 0%, 
                #1E293B 30%,
                #1E3A5F 60%,
                #312E81 100%);
            background-attachment: fixed;
            position: relative;
        }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* æµæ˜Ÿ */
        .meteor {
            position: fixed;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, white, transparent);
            box-shadow: 0 0 10px 2px rgba(255,255,255,0.5);
            animation: shooting 4s linear infinite;
            opacity: 0;
            z-index: 0;
        }

        .meteor:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .meteor:nth-child(2) { top: 20%; left: 60%; animation-delay: 2s; }
        .meteor:nth-child(3) { top: 5%; left: 80%; animation-delay: 4s; }

        @keyframes shooting {
            0% { transform: translateX(0) translateY(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(300px) translateY(300px); opacity: 0; }
        }

        /* æ¼‚æµ®æ˜Ÿçƒ */
        .planets {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .planet {
            position: absolute;
            animation: planetFloat 8s ease-in-out infinite;
            font-size: 2.5rem;
            filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.5));
        }

        .planet:nth-child(1) { top: 15%; right: 8%; animation-delay: 0s; }
        .planet:nth-child(2) { top: 45%; left: 5%; animation-delay: 2s; font-size: 2rem; }
        .planet:nth-child(3) { top: 70%; right: 5%; animation-delay: 4s; font-size: 1.8rem; }
        .planet:nth-child(4) { top: 25%; left: 3%; animation-delay: 1s; font-size: 1.5rem; }

        @keyframes planetFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
            position: relative;
            z-index: 2;
        }

        /* æ¨™é¡Œå€ */
        .header {
            text-align: center;
            padding: 35px 25px;
            background: linear-gradient(145deg, #3B82F6, #8B5CF6, #6D28D9);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
            border-radius: 30px;
            margin-bottom: 25px;
            box-shadow: 
                0 15px 50px rgba(139, 92, 246, 0.5),
                0 0 100px rgba(59, 130, 246, 0.3),
                0 0 0 1px rgba(255,255,255,0.1) inset;
            position: relative;
            overflow: hidden;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
            animation: shimmer 4s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.3; }
            50% { transform: rotate(180deg) scale(1.2); opacity: 0.6; }
        }

        .header h1 {
            font-size: 2.4rem;
            font-weight: 900;
            color: var(--white);
            text-shadow: 
                0 0 30px rgba(255,255,255,0.5),
                3px 3px 0 rgba(0,0,0,0.2);
            position: relative;
            letter-spacing: 3px;
        }

        .header .mascot {
            font-size: 4.5rem;
            display: block;
            margin-bottom: 10px;
            animation: rocketBounce 3s ease-in-out infinite;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));
        }

        @keyframes rocketBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .header .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.15rem;
            margin-top: 12px;
            font-weight: 700;
        }

        /* ç©å®¶è³‡è¨Šå¡ */
        .player-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 25px;
            padding: 22px 28px;
            margin-bottom: 25px;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.3),
                0 0 0 1px rgba(139, 92, 246, 0.3) inset;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            backdrop-filter: blur(10px);
        }

        .player-avatar {
            width: 75px;
            height: 75px;
            background: linear-gradient(135deg, #3B82F6, #8B5CF6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8rem;
            box-shadow: 
                0 0 30px rgba(139, 92, 246, 0.5),
                0 0 0 3px rgba(255,255,255,0.2) inset;
            animation: avatarGlow 3s ease-in-out infinite;
        }

        @keyframes avatarGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 0 0 3px rgba(255,255,255,0.2) inset; }
            50% { box-shadow: 0 0 50px rgba(139, 92, 246, 0.8), 0 0 0 3px rgba(255,255,255,0.3) inset; }
        }

        .player-info {
            flex: 1;
            min-width: 150px;
        }

        .player-name {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 5px;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .player-level {
            color: rgba(255,255,255,0.7);
            font-weight: 700;
        }

        .level-badge {
            background: linear-gradient(135deg, var(--yellow), var(--orange));
            padding: 3px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #1E293B;
            font-weight: 800;
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.5);
        }

        .player-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
            padding: 14px 20px;
            border-radius: 18px;
            text-align: center;
            min-width: 90px;
            border: 1px solid rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .stat-box.stars {
            background: linear-gradient(135deg, rgba(250, 204, 21, 0.2), rgba(249, 115, 22, 0.2));
            border-color: rgba(250, 204, 21, 0.3);
        }

        .stat-box.exp {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(59, 130, 246, 0.2));
            border-color: rgba(6, 182, 212, 0.3);
        }

        .stat-number {
            font-size: 1.6rem;
            font-weight: 900;
            color: var(--white);
        }

        .stat-label {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
            font-weight: 700;
            margin-top: 2px;
        }

        /* é—œå¡é¸æ“‡å€ */
        .levels-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.7rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(165px, 1fr));
            gap: 18px;
        }

        .level-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 24px;
            padding: 22px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            border-radius: 3px 3px 0 0;
        }

        .level-card.numbers::before { background: linear-gradient(90deg, #3B82F6, #60A5FA); }
        .level-card.multiply::before { background: linear-gradient(90deg, #8B5CF6, #A78BFA); }
        .level-card.divide::before { background: linear-gradient(90deg, #6D28D9, #7C3AED); }
        .level-card.shapes::before { background: linear-gradient(90deg, #06B6D4, #22D3EE); }
        .level-card.time::before { background: linear-gradient(90deg, #F97316, #FB923C); }

        .level-card:hover {
            transform: translateY(-12px) scale(1.02);
        }

        .level-card.numbers:hover { border-color: #3B82F6; box-shadow: 0 20px 50px rgba(59, 130, 246, 0.4); }
        .level-card.multiply:hover { border-color: #8B5CF6; box-shadow: 0 20px 50px rgba(139, 92, 246, 0.4); }
        .level-card.divide:hover { border-color: #6D28D9; box-shadow: 0 20px 50px rgba(109, 40, 217, 0.4); }
        .level-card.shapes:hover { border-color: #06B6D4; box-shadow: 0 20px 50px rgba(6, 182, 212, 0.4); }
        .level-card.time:hover { border-color: #F97316; box-shadow: 0 20px 50px rgba(249, 115, 22, 0.4); }

        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(50%);
        }

        .level-card.locked:hover {
            transform: none;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .level-icon {
            font-size: 3.2rem;
            margin-bottom: 12px;
            display: block;
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.3));
            transition: transform 0.3s ease;
        }

        .level-card:hover .level-icon {
            transform: scale(1.2) rotate(10deg);
        }

        .level-name {
            font-size: 1.15rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 6px;
        }

        .level-desc {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
            font-weight: 600;
        }

        .level-progress {
            margin-top: 12px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .level-progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .level-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        .numbers .level-progress-bar { background: linear-gradient(90deg, #3B82F6, #60A5FA); }
        .multiply .level-progress-bar { background: linear-gradient(90deg, #8B5CF6, #A78BFA); }
        .divide .level-progress-bar { background: linear-gradient(90deg, #6D28D9, #7C3AED); }
        .shapes .level-progress-bar { background: linear-gradient(90deg, #06B6D4, #22D3EE); }
        .time .level-progress-bar { background: linear-gradient(90deg, #F97316, #FB923C); }

        .lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(3px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border-radius: 24px;
        }

        /* éŠæˆ²å€ */
        .game-area {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border-radius: 30px;
            padding: 35px;
            box-shadow: 
                0 15px 50px rgba(0,0,0,0.4),
                0 0 0 1px rgba(139, 92, 246, 0.2) inset;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .info-badge {
            background: linear-gradient(135deg, var(--purple), var(--blue));
            padding: 10px 18px;
            border-radius: 20px;
            font-weight: 800;
            color: white;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .energy-hearts {
            font-size: 1.6rem;
            letter-spacing: 6px;
            filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.5));
        }

        .question-area {
            text-align: center;
            padding: 40px 30px;
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 28px;
            margin-bottom: 28px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            position: relative;
        }

        .question-image {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: questionPulse 2s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(139, 92, 246, 0.5));
        }

        @keyframes questionPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .question-text {
            font-size: 1.8rem;
            color: var(--white);
            font-weight: 800;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .question-hint {
            font-size: 1rem;
            color: rgba(255,255,255,0.6);
            font-weight: 600;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 15px;
            display: inline-block;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 25px;
        }

        .answer-btn {
            padding: 22px;
            font-size: 1.4rem;
            font-weight: 800;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 22px;
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: 'Nunito', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .answer-btn:hover::before {
            left: 100%;
        }

        .answer-btn:hover {
            border-color: var(--purple);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.4);
        }

        .answer-btn.correct {
            background: linear-gradient(145deg, #22C55E, #16A34A);
            border-color: #22C55E;
            animation: correctPulse 0.6s ease;
            box-shadow: 0 0 40px rgba(34, 197, 94, 0.6);
        }

        .answer-btn.wrong {
            background: linear-gradient(145deg, #EF4444, #DC2626);
            border-color: #EF4444;
            animation: wrongShake 0.6s ease;
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.6);
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-12px); }
            40% { transform: translateX(12px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(8px); }
        }

        .back-btn {
            background: linear-gradient(145deg, #475569, #334155);
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 18px;
            font-size: 1.05rem;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* ç­”éŒ¯æç¤º */
        .wrong-feedback {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .feedback-card {
            background: linear-gradient(145deg, #1E293B, #0F172A);
            border-radius: 30px;
            padding: 35px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 
                0 25px 80px rgba(0,0,0,0.5),
                0 0 0 1px rgba(139, 92, 246, 0.3) inset;
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes modalPop {
            from { transform: scale(0.7) translateY(30px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .feedback-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .feedback-title {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--orange);
            margin-bottom: 20px;
        }

        .feedback-content {
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .feedback-question {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 15px;
        }

        .feedback-answer {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--green);
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        .feedback-steps {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: left;
            margin-bottom: 15px;
        }

        .feedback-steps-title {
            font-size: 1rem;
            color: var(--cyan);
            font-weight: 800;
            margin-bottom: 10px;
        }

        .feedback-step {
            color: rgba(255,255,255,0.8);
            font-size: 1rem;
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .feedback-step::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--yellow);
        }

        .feedback-hint {
            background: rgba(250, 204, 21, 0.1);
            padding: 12px 18px;
            border-radius: 15px;
            font-size: 1rem;
            color: var(--yellow);
            font-weight: 600;
            border: 1px solid rgba(250, 204, 21, 0.2);
        }

        .feedback-your-answer {
            color: rgba(255,255,255,0.6);
            margin-top: 15px;
            font-weight: 600;
        }

        .feedback-your-answer span {
            color: #EF4444;
            font-weight: 800;
        }

        .feedback-btn {
            background: linear-gradient(145deg, var(--purple), var(--blue));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        .feedback-btn:hover {
            transform: translateY(-3px) scale(1.05);
        }

        /* çµæœç•«é¢ */
        .result-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .result-icon {
            font-size: 7rem;
            margin-bottom: 25px;
            animation: resultBounce 1s ease infinite;
            filter: drop-shadow(0 0 40px rgba(139, 92, 246, 0.6));
        }

        @keyframes resultBounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(-5deg); }
            75% { transform: translateY(-10px) rotate(5deg); }
        }

        .result-title {
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 15px;
        }

        .result-title.success {
            color: var(--green);
            text-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }

        .result-title.fail {
            color: var(--orange);
            text-shadow: 0 0 30px rgba(249, 115, 22, 0.5);
        }

        .result-message {
            font-size: 1.15rem;
            color: rgba(255,255,255,0.7);
            font-weight: 600;
        }

        .result-stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .result-stat {
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            padding: 22px 32px;
            border-radius: 22px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .result-stat-number {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--white);
        }

        .result-stat-label {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.6);
            font-weight: 700;
        }

        /* ç¸½è¤‡ç¿’å€ */
        .review-section {
            margin-top: 30px;
            text-align: left;
        }

        .review-title {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 20px;
            text-align: center;
        }

        .review-list {
            display: grid;
            gap: 12px;
            max-height: 350px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .review-list::-webkit-scrollbar {
            width: 8px;
        }

        .review-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .review-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--purple), var(--blue));
            border-radius: 10px;
        }

        .review-item {
            display: flex;
            align-items: center;
            padding: 15px 18px;
            border-radius: 18px;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .review-item.correct {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.15));
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .review-item.wrong {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.15));
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .review-item:hover {
            transform: translateX(5px);
        }

        .review-emoji {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .review-content {
            flex: 1;
        }

        .review-question {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--white);
        }

        .review-answer {
            font-size: 0.95rem;
            color: var(--green);
            font-weight: 700;
        }

        .review-your-answer {
            font-size: 0.85rem;
            color: #EF4444;
            font-weight: 600;
        }

        .review-status {
            font-size: 1.5rem;
        }

        .result-buttons {
            display: flex;
            gap: 18px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .result-btn {
            padding: 16px 40px;
            border-radius: 22px;
            font-size: 1.15rem;
            font-weight: 800;
            border: none;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
        }

        .result-btn.primary {
            background: linear-gradient(145deg, var(--purple), var(--blue));
            color: white;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
        }

        .result-btn.secondary {
            background: transparent;
            border: 2px solid var(--purple);
            color: var(--purple);
        }

        .result-btn:hover {
            transform: translateY(-5px) scale(1.05);
        }

        /* å­¸ç¿’ç´€éŒ„å€ */
        .records-section {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 28px;
            padding: 28px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .records-list {
            max-height: 320px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .record-item {
            display: flex;
            align-items: center;
            padding: 16px 18px;
            border-radius: 18px;
            margin-bottom: 12px;
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            gap: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .record-item:hover {
            transform: translateX(8px);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .record-icon {
            font-size: 2.2rem;
        }

        .record-info {
            flex: 1;
        }

        .record-title {
            font-weight: 800;
            color: var(--white);
            font-size: 1.05rem;
        }

        .record-date {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.5);
            font-weight: 600;
        }

        .record-score {
            font-size: 1.3rem;
            font-weight: 900;
            color: var(--yellow);
            background: rgba(250, 204, 21, 0.1);
            padding: 6px 14px;
            border-radius: 12px;
        }

        .empty-records {
            text-align: center;
            padding: 50px;
            color: rgba(255,255,255,0.5);
        }

        .empty-records-icon {
            font-size: 5rem;
            margin-bottom: 18px;
            opacity: 0.5;
        }

        /* éŸ³é‡æ§åˆ¶ */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(145deg, #1E293B, #0F172A);
            border: 2px solid var(--purple);
            font-size: 1.6rem;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
        }

        .sound-toggle:hover {
            transform: scale(1.15) rotate(10deg);
        }

        /* å½ˆçª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal {
            background: linear-gradient(145deg, #1E293B, #0F172A);
            border-radius: 35px;
            padding: 45px;
            text-align: center;
            max-width: 420px;
            width: 100%;
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 25px 80px rgba(0,0,0,0.5),
                0 0 0 1px rgba(139, 92, 246, 0.3) inset,
                0 0 100px rgba(139, 92, 246, 0.2);
        }

        .modal-icon {
            font-size: 5rem;
            margin-bottom: 18px;
            animation: rocketBounce 3s ease-in-out infinite;
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 12px;
        }

        .modal-text {
            color: rgba(255,255,255,0.7);
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .modal-input {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 18px;
            font-size: 1.2rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            background: rgba(255,255,255,0.05);
            color: var(--white);
            transition: all 0.3s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--purple);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
        }

        .modal-input::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .modal-btn {
            background: linear-gradient(145deg, var(--purple), var(--blue));
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 22px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 10px 35px rgba(139, 92, 246, 0.5);
        }

        .modal-btn:hover {
            transform: translateY(-5px) scale(1.05);
        }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.8rem; }
            .header .mascot { font-size: 3.5rem; }
            .player-card { flex-direction: column; text-align: center; }
            .answers-grid { grid-template-columns: 1fr; }
            .question-text { font-size: 1.4rem; }
            .question-image { font-size: 4rem; }
        }
    </style>
</head>
<body>
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">ğŸ”Š</button>

    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars" id="starsContainer"></div>

    <!-- æµæ˜Ÿ -->
    <div class="meteor"></div>
    <div class="meteor"></div>
    <div class="meteor"></div>

    <!-- æ¼‚æµ®æ˜Ÿçƒ -->
    <div class="planets">
        <span class="planet">ğŸª</span>
        <span class="planet">ğŸŒ™</span>
        <span class="planet">â­</span>
        <span class="planet">âœ¨</span>
    </div>

    <!-- åå­—è¼¸å…¥å½ˆçª— -->
    <div class="modal-overlay" id="nameModal">
        <div class="modal">
            <div class="modal-icon">ğŸš€</div>
            <h2 class="modal-title">æ­¡è¿ä¾†åˆ°æ•¸å­¸æ˜Ÿçƒï¼</h2>
            <p class="modal-text">å°è›¹æº–å‚™å¥½æ¢ç´¢æ•¸å­¸å®‡å®™äº†å—ï¼Ÿ</p>
            <input type="text" class="modal-input" id="playerNameInput" placeholder="è¼¸å…¥ä½ çš„åå­—..." maxlength="10">
            <button class="modal-btn" onclick="setPlayerName()">ç™¼å°„å‡ç©ºï¼ğŸš€</button>
        </div>
    </div>

    <div class="container">
        <!-- æ¨™é¡Œ -->
        <header class="header">
            <span class="mascot">ğŸš€</span>
            <h1>å°è›¹çš„æ•¸å­¸æ˜Ÿçƒå†’éšª</h1>
            <p class="subtitle">æ­ä¸Šç«ç®­ï¼Œä¸€èµ·æ¢ç´¢æ•¸å­¸çš„å®‡å®™å§ï¼</p>
        </header>

        <!-- ç©å®¶è³‡è¨Š -->
        <div class="player-card">
            <div class="player-avatar">ğŸ›</div>
            <div class="player-info">
                <div class="player-name" id="playerName">å°è›¹</div>
                <div class="player-level">
                    ç­‰ç´šï¼š<span class="level-badge">Lv.<span id="playerLevel">1</span></span>
                    <span id="levelTitle">æ•¸å­¸æ–°æ‰‹</span>
                </div>
            </div>
            <div class="player-stats">
                <div class="stat-box stars">
                    <div class="stat-number" id="playerStars">0</div>
                    <div class="stat-label">â­ æ˜Ÿæ˜Ÿå¹£</div>
                </div>
                <div class="stat-box exp">
                    <div class="stat-number" id="playerExp">0</div>
                    <div class="stat-label">ğŸš€ ç¶“é©—å€¼</div>
                </div>
            </div>
        </div>

        <!-- ä¸»ç•«é¢ -->
        <div id="mainScreen">
            <div class="levels-section">
                <h2 class="section-title">ğŸŒŒ é¸æ“‡æ˜Ÿçƒ</h2>
                <div class="levels-grid">
                    <div class="level-card numbers" onclick="startGame('numbers')">
                        <span class="level-icon">ğŸ”¢</span>
                        <div class="level-name">æ•¸å­—æ˜Ÿçƒ</div>
                        <div class="level-desc">åŠ æ¸›æ³•ç·´ç¿’</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressNumbers" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card multiply" id="levelMultiply" onclick="startGame('multiply')">
                        <span class="level-icon">âœ–ï¸</span>
                        <div class="level-name">ä¹˜æ³•éŠ€æ²³</div>
                        <div class="level-desc">ä¹ä¹ä¹˜æ³•è¡¨</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressMultiply" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card divide" id="levelDivide" onclick="startGame('divide')">
                        <span class="level-icon">â—</span>
                        <div class="level-name">é™¤æ³•é»‘æ´</div>
                        <div class="level-desc">é™¤æ³•åŸºç¤</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressDivide" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card shapes" id="levelShapes" onclick="startGame('shapes')">
                        <span class="level-icon">ğŸ“</span>
                        <div class="level-name">åœ–å½¢å¤ªç©ºç«™</div>
                        <div class="level-desc">åœ–å½¢èˆ‡å‘¨é•·</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressShapes" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card time" id="levelTime" onclick="startGame('time')">
                        <span class="level-icon">â°</span>
                        <div class="level-name">æ™‚é–“èŸ²æ´</div>
                        <div class="level-desc">æ™‚é–“èˆ‡å®¹é‡</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressTime" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="records-section">
                <h2 class="section-title">ğŸ“Š æ¢éšªç´€éŒ„</h2>
                <div class="records-list" id="recordsList">
                    <div class="empty-records">
                        <div class="empty-records-icon">ğŸ›¸</div>
                        <p>é‚„æ²’æœ‰ç´€éŒ„å–”ï¼å¿«ä¾†æ¢ç´¢æ˜Ÿçƒå§ï¼</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- éŠæˆ²å€ -->
        <div class="game-area" id="gameArea">
            <div class="game-header">
                <h2 class="game-title" id="gameTitle">ğŸ”¢ æ•¸å­—æ˜Ÿçƒ</h2>
                <div class="game-info">
                    <div class="info-badge">é¡Œç›®ï¼š<span id="questionNum">1</span>/10</div>
                    <div class="energy-hearts" id="energyHearts">ğŸ’œğŸ’œğŸ’œ</div>
                </div>
            </div>
            
            <div class="question-area">
                <div class="question-image" id="questionImage">ğŸ”¢</div>
                <div class="question-text" id="questionText">125 + 234 = ?</div>
                <div class="question-hint" id="questionHint">ğŸ’¡ æç¤ºï¼šå…ˆç®—å€‹ä½æ•¸</div>
            </div>

            <div class="answers-grid" id="answersGrid">
                <button class="answer-btn">359</button>
                <button class="answer-btn">349</button>
                <button class="answer-btn">369</button>
                <button class="answer-btn">339</button>
            </div>

            <button class="back-btn" onclick="backToMain()">â† è¿”å›ä¸»ç•«é¢</button>
        </div>

        <!-- çµæœç•«é¢ -->
        <div class="game-area" id="resultScreen" style="display: none;">
            <div class="result-screen">
                <div class="result-icon" id="resultIcon">ğŸ‰</div>
                <h2 class="result-title success" id="resultTitle">å¤ªå²å®³äº†ï¼</h2>
                <p class="result-message" id="resultMessage">ä½ æˆåŠŸå¾æœäº†é€™å€‹æ˜Ÿçƒï¼</p>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="result-stat-number" id="resultCorrect">0</div>
                        <div class="result-stat-label">ç­”å°é¡Œæ•¸</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-number" id="resultStars">+0</div>
                        <div class="result-stat-label">æ˜Ÿæ˜Ÿå¹£</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-number" id="resultExp">+0</div>
                        <div class="result-stat-label">ç¶“é©—å€¼</div>
                    </div>
                </div>

                <div class="review-section">
                    <h3 class="review-title">ğŸ“– ç¸½è¤‡ç¿’æ™‚é–“</h3>
                    <div class="review-list" id="reviewList"></div>
                </div>

                <div class="result-buttons">
                    <button class="result-btn primary" onclick="restartGame()">å†ç©ä¸€æ¬¡ ğŸ”„</button>
                    <button class="result-btn secondary" onclick="backToMain()">è¿”å›ä¸»ç•«é¢</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç”Ÿæˆæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            const container = document.getElementById('starsContainer');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }
        }
        createStars();

        // éŸ³æ•ˆç³»çµ±
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        let soundEnabled = true;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            if (soundEnabled) playClickSound();
        }

        function playCorrectSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [523.25, 659.25, 783.99];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime + i * 0.1);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.2);
                osc.type = 'sine';
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.2);
            });
        }

        function playWrongSound() {
            if (!soundEnabled) return;
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.type = 'sawtooth';
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playClickSound() {
            if (!soundEnabled) return;
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.type = 'sine';
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playStartSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [261.63, 329.63, 392.00, 523.25];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const t = audioCtx.currentTime + i * 0.1;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0.25, t);
                gain.gain.linearRampToValueAtTime(0.01, t + 0.15);
                osc.type = 'sine';
                osc.start(t);
                osc.stop(t + 0.15);
            });
        }

        function playWinSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [523.25, 587.33, 659.25, 698.46, 783.99, 880, 987.77, 1046.50];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const t = audioCtx.currentTime + i * 0.08;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.linearRampToValueAtTime(0.01, t + 0.12);
                osc.type = 'sine';
                osc.start(t);
                osc.stop(t + 0.12);
            });
        }

        function playLoseSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [400, 350, 300, 250];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const t = audioCtx.currentTime + i * 0.15;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.linearRampToValueAtTime(0.01, t + 0.2);
                osc.type = 'triangle';
                osc.start(t);
                osc.stop(t + 0.2);
            });
        }

        // é¡Œç›®è³‡æ–™åº«
        const questions = {
            numbers: [
                { q: '2847 + 1956 = ?', a: '4803', opts: ['4703', '4803', '4813', '4903'], hint: 'å¤šæ¬¡é€²ä½ï¼Œä»”ç´°ç®—', steps: ['å€‹ä½ï¼š7 + 6 = 13ï¼ˆé€²ä½1ï¼‰', 'åä½ï¼š4 + 5 + 1 = 10ï¼ˆé€²ä½1ï¼‰', 'ç™¾ä½ï¼š8 + 9 + 1 = 18ï¼ˆé€²ä½1ï¼‰', 'åƒä½ï¼š2 + 1 + 1 = 4', 'ç­”æ¡ˆï¼š4803'] },
                { q: '5003 - 2678 = ?', a: '2325', opts: ['2225', '2325', '2335', '2425'], hint: 'é€£çºŒå€Ÿä½è¦å°å¿ƒ', steps: ['5003 è¦é€£çºŒå€Ÿä½', 'å€‹ä½ï¼š13 - 8 = 5', 'åä½ï¼š9 - 7 = 2', 'ç™¾ä½ï¼š9 - 6 = 3', 'åƒä½ï¼š4 - 2 = 2', 'ç­”æ¡ˆï¼š2325'] },
                { q: 'â–¡ + 1847 = 3500ï¼Œâ–¡ = ?', a: '1653', opts: ['1553', '1653', '1753', '1853'], hint: 'ç”¨æ¸›æ³•åæ¨', steps: ['â–¡ = 3500 - 1847', 'å€‹ä½ï¼š10 - 7 = 3ï¼ˆå€Ÿä½ï¼‰', 'åä½ï¼š9 - 4 = 5', 'ç™¾ä½ï¼š4 - 8 éœ€å€Ÿä½ = 6', 'åƒä½ï¼š2 - 1 = 1', 'ç­”æ¡ˆï¼š1653'] },
                { q: '3276 + 2845 = ?', a: '6121', opts: ['6021', '6111', '6121', '6221'], hint: 'å››ä½æ•¸åŠ æ³•é€²ä½', steps: ['å€‹ä½ï¼š6 + 5 = 11ï¼ˆé€²ä½1ï¼‰', 'åä½ï¼š7 + 4 + 1 = 12ï¼ˆé€²ä½1ï¼‰', 'ç™¾ä½ï¼š2 + 8 + 1 = 11ï¼ˆé€²ä½1ï¼‰', 'åƒä½ï¼š3 + 2 + 1 = 6', 'ç­”æ¡ˆï¼š6121'] },
                { q: '7000 - 3456 = ?', a: '3544', opts: ['3444', '3544', '3554', '3644'], hint: 'å¾7000é€£çºŒå€Ÿä½', steps: ['7000 = 6-9-9-10', 'å€‹ä½ï¼š10 - 6 = 4', 'åä½ï¼š9 - 5 = 4', 'ç™¾ä½ï¼š9 - 4 = 5', 'åƒä½ï¼š6 - 3 = 3', 'ç­”æ¡ˆï¼š3544'] },
                { q: '4582 - â–¡ = 1967ï¼Œâ–¡ = ?', a: '2615', opts: ['2515', '2615', '2715', '2815'], hint: 'â–¡ = 4582 - 1967', steps: ['â–¡ = 4582 - 1967', 'å€‹ä½ï¼š12 - 7 = 5ï¼ˆå€Ÿä½ï¼‰', 'åä½ï¼š7 - 6 = 1', 'ç™¾ä½ï¼š4 - 9 éœ€å€Ÿä½ = 6', 'åƒä½ï¼š3 - 1 = 2', 'ç­”æ¡ˆï¼š2615'] },
                { q: '1234 + 2345 + 421 = ?', a: '4000', opts: ['3900', '4000', '4100', '4010'], hint: 'ä¸‰å€‹æ•¸ç›¸åŠ ', steps: ['å…ˆç®— 1234 + 2345 = 3579', 'å†ç®— 3579 + 421 = 4000', 'ç­”æ¡ˆï¼š4000'] },
                { q: '8010 - 4536 = ?', a: '3474', opts: ['3374', '3474', '3574', '3484'], hint: 'ä¸­é–“æœ‰0è¦å€Ÿä½', steps: ['å€‹ä½ï¼š10 - 6 = 4ï¼ˆå€Ÿä½ï¼‰', 'åä½ï¼š0 - 3 éœ€è¦å€Ÿä½', 'ç™¾ä½ï¼š9 - 5 = 4ï¼ˆå€Ÿçµ¦åä½å¾Œï¼‰', 'åƒä½ï¼š7 - 4 = 3', 'ç­”æ¡ˆï¼š3474'] },
                { q: 'æ¯”5000å¤§123çš„æ•¸æ˜¯ï¼Ÿ', a: '5123', opts: ['4877', '5023', '5123', '5230'], hint: '5000 + 123', steps: ['æ¯”5000å¤§123', 'å°±æ˜¯ 5000 + 123', '= 5123'] },
                { q: '6543 - 2789 = ?', a: '3754', opts: ['3654', '3754', '3854', '3764'], hint: 'æ¯ä½éƒ½è¦å€Ÿä½', steps: ['å€‹ä½ï¼š13 - 9 = 4ï¼ˆå€Ÿä½ï¼‰', 'åä½ï¼š13 - 8 = 5ï¼ˆå€Ÿä½ï¼‰', 'ç™¾ä½ï¼š4 - 7 éœ€å€Ÿä½ = 7', 'åƒä½ï¼š5 - 2 = 3', 'ç­”æ¡ˆï¼š3754'] }
            ],
            multiply: [
                { q: '23 Ã— 4 = ?', a: '92', opts: ['82', '88', '92', '96'], hint: '20Ã—4=80ï¼Œ3Ã—4=12', steps: ['æ‹†é–‹ç®—ï¼š23 = 20 + 3', '20 Ã— 4 = 80', '3 Ã— 4 = 12', '80 + 12 = 92'] },
                { q: '36 Ã— 5 = ?', a: '180', opts: ['150', '170', '180', '190'], hint: '30Ã—5=150ï¼Œ6Ã—5=30', steps: ['æ‹†é–‹ç®—ï¼š36 = 30 + 6', '30 Ã— 5 = 150', '6 Ã— 5 = 30', '150 + 30 = 180'] },
                { q: 'ä¸€ç›’æœ‰24é¡†ç³–ï¼Œè²·3ç›’å…±å¹¾é¡†ï¼Ÿ', a: '72', opts: ['62', '68', '72', '78'], hint: '24 Ã— 3', steps: ['24 Ã— 3', '20 Ã— 3 = 60', '4 Ã— 3 = 12', '60 + 12 = 72é¡†'] },
                { q: '45 Ã— 6 = ?', a: '270', opts: ['250', '260', '270', '280'], hint: '40Ã—6=240ï¼Œ5Ã—6=30', steps: ['æ‹†é–‹ç®—ï¼š45 = 40 + 5', '40 Ã— 6 = 240', '5 Ã— 6 = 30', '240 + 30 = 270'] },
                { q: '17 Ã— 8 = ?', a: '136', opts: ['126', '132', '136', '144'], hint: '10Ã—8=80ï¼Œ7Ã—8=56', steps: ['æ‹†é–‹ç®—ï¼š17 = 10 + 7', '10 Ã— 8 = 80', '7 Ã— 8 = 56', '80 + 56 = 136'] },
                { q: 'æ¯æ’æœ‰19äººï¼Œ4æ’å…±å¹¾äººï¼Ÿ', a: '76', opts: ['66', '72', '76', '80'], hint: '19 Ã— 4', steps: ['19 Ã— 4', '10 Ã— 4 = 40', '9 Ã— 4 = 36', '40 + 36 = 76äºº'] },
                { q: '52 Ã— 7 = ?', a: '364', opts: ['344', '354', '364', '374'], hint: '50Ã—7=350ï¼Œ2Ã—7=14', steps: ['æ‹†é–‹ç®—ï¼š52 = 50 + 2', '50 Ã— 7 = 350', '2 Ã— 7 = 14', '350 + 14 = 364'] },
                { q: '28 Ã— 9 = ?', a: '252', opts: ['242', '248', '252', '262'], hint: '30Ã—9=270ï¼Œæ¸›2Ã—9=18', steps: ['28 Ã— 9 = (30-2) Ã— 9', '30 Ã— 9 = 270', '2 Ã— 9 = 18', '270 - 18 = 252'] },
                { q: 'ä¸€å¤©å·¥ä½œ8å°æ™‚ï¼Œä¸€é€±5å¤©å…±å¹¾å°æ™‚ï¼Ÿ', a: '40', opts: ['35', '40', '45', '48'], hint: '8 Ã— 5', steps: ['æ¯å¤©8å°æ™‚ Ã— 5å¤©', '8 Ã— 5 = 40å°æ™‚'] },
                { q: '63 Ã— 4 = ?', a: '252', opts: ['242', '248', '252', '262'], hint: '60Ã—4=240ï¼Œ3Ã—4=12', steps: ['æ‹†é–‹ç®—ï¼š63 = 60 + 3', '60 Ã— 4 = 240', '3 Ã— 4 = 12', '240 + 12 = 252'] }
            ],
            divide: [
                { q: '96 Ã· 8 = ?', a: '12', opts: ['10', '11', '12', '13'], hint: '8 Ã— 12 = 96', steps: ['æƒ³ï¼š8 Ã— ? = 96', '8 Ã— 10 = 80', '8 Ã— 12 = 96', 'æ‰€ä»¥ 96 Ã· 8 = 12'] },
                { q: '84 Ã· 7 = ?', a: '12', opts: ['11', '12', '13', '14'], hint: '7 Ã— 12 = 84', steps: ['æƒ³ï¼š7 Ã— ? = 84', '7 Ã— 10 = 70', '7 Ã— 12 = 84', 'æ‰€ä»¥ 84 Ã· 7 = 12'] },
                { q: '156 Ã· 6 = ?', a: '26', opts: ['24', '25', '26', '27'], hint: '6 Ã— 26 = 156', steps: ['å…ˆç®— 150 Ã· 6 = 25', 'å‰©ä¸‹ 6 Ã· 6 = 1', '25 + 1 = 26'] },
                { q: '175 Ã· 7 = ?', a: '25', opts: ['23', '24', '25', '26'], hint: '7 Ã— 25 = 175', steps: ['å…ˆç®— 140 Ã· 7 = 20', 'å†ç®— 35 Ã· 7 = 5', '20 + 5 = 25'] },
                { q: 'æœ‰144é¡†ç³–ï¼Œå¹³åˆ†çµ¦12äººï¼Œæ¯äººå¹¾é¡†ï¼Ÿ', a: '12', opts: ['10', '11', '12', '14'], hint: '144 Ã· 12', steps: ['144 Ã· 12', '12 Ã— 12 = 144', 'æ¯äºº 12 é¡†'] },
                { q: '234 Ã· 9 = ?', a: '26', opts: ['24', '25', '26', '27'], hint: '9 Ã— 26 = 234', steps: ['å…ˆç®— 180 Ã· 9 = 20', 'å†ç®— 54 Ã· 9 = 6', '20 + 6 = 26'] },
                { q: '85 Ã· 4 = ?...?', a: '21...1', opts: ['20...5', '21...1', '21...2', '22...1'], hint: '4Ã—21=84ï¼Œé¤˜1', steps: ['4 Ã— 20 = 80', '4 Ã— 21 = 84', '85 - 84 = 1ï¼ˆé¤˜æ•¸ï¼‰', 'ç­”æ¡ˆï¼š21...1'] },
                { q: '200 Ã· 8 = ?', a: '25', opts: ['24', '25', '26', '28'], hint: '8 Ã— 25 = 200', steps: ['å…ˆç®— 160 Ã· 8 = 20', 'å†ç®— 40 Ã· 8 = 5', '20 + 5 = 25'] },
                { q: '135 Ã· 5 = ?', a: '27', opts: ['25', '26', '27', '28'], hint: '5 Ã— 27 = 135', steps: ['å…ˆç®— 100 Ã· 5 = 20', 'å†ç®— 35 Ã· 5 = 7', '20 + 7 = 27'] },
                { q: '259 Ã· 6 = ?...?', a: '43...1', opts: ['42...1', '43...1', '43...2', '44...1'], hint: '6Ã—43=258ï¼Œé¤˜1', steps: ['6 Ã— 40 = 240', '6 Ã— 43 = 258', '259 - 258 = 1ï¼ˆé¤˜æ•¸ï¼‰', 'ç­”æ¡ˆï¼š43...1'] }
            ],
            shapes: [
                { q: 'æ­£æ–¹å½¢é‚Šé•·15cmï¼Œå‘¨é•·ï¼Ÿ', a: '60cm', opts: ['45cm', '55cm', '60cm', '65cm'], hint: '15 Ã— 4', steps: ['æ­£æ–¹å½¢å‘¨é•· = é‚Šé•· Ã— 4', '= 15 Ã— 4 = 60cm'] },
                { q: 'é•·æ–¹å½¢é•·18cmå¯¬7cmï¼Œå‘¨é•·ï¼Ÿ', a: '50cm', opts: ['46cm', '48cm', '50cm', '52cm'], hint: '(18+7) Ã— 2', steps: ['é•·æ–¹å½¢å‘¨é•· = (é•·+å¯¬) Ã— 2', '= (18 + 7) Ã— 2', '= 25 Ã— 2 = 50cm'] },
                { q: 'æ­£æ–¹å½¢å‘¨é•·æ˜¯48cmï¼Œé‚Šé•·ï¼Ÿ', a: '12cm', opts: ['10cm', '11cm', '12cm', '14cm'], hint: '48 Ã· 4', steps: ['æ­£æ–¹å½¢é‚Šé•· = å‘¨é•· Ã· 4', '= 48 Ã· 4 = 12cm'] },
                { q: 'ç­‰é‚Šä¸‰è§’å½¢é‚Šé•·14cmï¼Œå‘¨é•·ï¼Ÿ', a: '42cm', opts: ['38cm', '40cm', '42cm', '44cm'], hint: '14 Ã— 3', steps: ['ç­‰é‚Šä¸‰è§’å½¢3é‚Šä¸€æ¨£é•·', 'å‘¨é•· = é‚Šé•· Ã— 3', '= 14 Ã— 3 = 42cm'] },
                { q: 'é•·æ–¹å½¢å‘¨é•·56cmï¼Œé•·16cmï¼Œå¯¬ï¼Ÿ', a: '12cm', opts: ['10cm', '11cm', '12cm', '14cm'], hint: '(56Ã·2) - 16', steps: ['é•· + å¯¬ = å‘¨é•· Ã· 2', '= 56 Ã· 2 = 28', 'å¯¬ = 28 - 16 = 12cm'] },
                { q: 'æ­£æ–¹å½¢é‚Šé•·23cmï¼Œå‘¨é•·ï¼Ÿ', a: '92cm', opts: ['86cm', '88cm', '92cm', '96cm'], hint: '23 Ã— 4', steps: ['æ­£æ–¹å½¢å‘¨é•· = é‚Šé•· Ã— 4', '= 23 Ã— 4 = 92cm'] },
                { q: 'ç±¬ç¬†åœé•·æ–¹å½¢èœåœ’ï¼Œé•·25må¯¬15mï¼Œç±¬ç¬†å¹¾å…¬å°ºï¼Ÿ', a: '80m', opts: ['70m', '75m', '80m', '85m'], hint: 'å‘¨é•· = (25+15) Ã— 2', steps: ['ç±¬ç¬†é•·åº¦ = å‘¨é•·', '= (25 + 15) Ã— 2', '= 40 Ã— 2 = 80m'] },
                { q: 'æ­£æ–¹å½¢å‘¨é•·æ˜¯100cmï¼Œé‚Šé•·ï¼Ÿ', a: '25cm', opts: ['20cm', '24cm', '25cm', '30cm'], hint: '100 Ã· 4', steps: ['æ­£æ–¹å½¢é‚Šé•· = å‘¨é•· Ã· 4', '= 100 Ã· 4 = 25cm'] },
                { q: 'é•·æ–¹å½¢é•·æ˜¯å¯¬çš„2å€ï¼Œå¯¬9cmï¼Œå‘¨é•·ï¼Ÿ', a: '54cm', opts: ['48cm', '52cm', '54cm', '58cm'], hint: 'é•·=18ï¼Œ(18+9)Ã—2', steps: ['é•· = 9 Ã— 2 = 18cm', 'å‘¨é•· = (18 + 9) Ã— 2', '= 27 Ã— 2 = 54cm'] },
                { q: 'ç”¨ä¸€æ¢120cmç¹©å­åœæ­£æ–¹å½¢ï¼Œé‚Šé•·ï¼Ÿ', a: '30cm', opts: ['25cm', '28cm', '30cm', '35cm'], hint: '120 Ã· 4', steps: ['ç¹©å­é•·åº¦ = å‘¨é•·', 'é‚Šé•· = 120 Ã· 4 = 30cm'] }
            ],
            time: [
                { q: '3å°æ™‚45åˆ† = å¹¾åˆ†é˜ï¼Ÿ', a: '225', opts: ['215', '220', '225', '235'], hint: '3Ã—60+45', steps: ['3å°æ™‚ = 3 Ã— 60 = 180åˆ†é˜', '180 + 45 = 225åˆ†é˜'] },
                { q: '9:48å†é35åˆ†é˜æ˜¯ï¼Ÿ', a: '10:23', opts: ['10:13', '10:18', '10:23', '10:33'], hint: '48+35=83ï¼Œé€²1å°æ™‚é¤˜23åˆ†', steps: ['48 + 35 = 83åˆ†é˜', '83åˆ†é˜ = 1å°æ™‚23åˆ†', '9é» + 1å°æ™‚ = 10é»', 'ç­”æ¡ˆï¼š10:23'] },
                { q: 'ä¸Šåˆ10:30åˆ°ä¸‹åˆ2:15ï¼Œç¶“éå¹¾å°æ™‚å¹¾åˆ†ï¼Ÿ', a: '3å°æ™‚45åˆ†', opts: ['3å°æ™‚15åˆ†', '3å°æ™‚30åˆ†', '3å°æ™‚45åˆ†', '4å°æ™‚15åˆ†'], hint: '10:30åˆ°14:15', steps: ['ä¸‹åˆ2:15 = 14:15', '14:15 - 10:30', '= 3å°æ™‚45åˆ†'] },
                { q: '2å…¬å‡350æ¯«å‡ = å¹¾æ¯«å‡ï¼Ÿ', a: '2350', opts: ['2035', '2305', '2350', '2530'], hint: '2Ã—1000+350', steps: ['2å…¬å‡ = 2000æ¯«å‡', '2000 + 350 = 2350æ¯«å‡'] },
                { q: 'é›»å½±3:45é–‹å§‹ï¼Œç‰‡é•·1å°æ™‚50åˆ†ï¼Œå¹¾é»çµæŸï¼Ÿ', a: '5:35', opts: ['5:25', '5:30', '5:35', '5:45'], hint: '3:45 + 1:50', steps: ['45 + 50 = 95åˆ† = 1å°æ™‚35åˆ†', '3é» + 1 + 1 = 5é»', 'ç­”æ¡ˆï¼š5:35'] },
                { q: '185åˆ†é˜ = å¹¾å°æ™‚å¹¾åˆ†ï¼Ÿ', a: '3å°æ™‚5åˆ†', opts: ['2å°æ™‚65åˆ†', '3å°æ™‚5åˆ†', '3å°æ™‚15åˆ†', '3å°æ™‚25åˆ†'], hint: '185Ã·60', steps: ['185 Ã· 60 = 3...5', 'å•†3 = 3å°æ™‚', 'é¤˜5 = 5åˆ†é˜', 'ç­”æ¡ˆï¼š3å°æ™‚5åˆ†'] },
                { q: '4500æ¯«å‡ = å¹¾å…¬å‡å¹¾æ¯«å‡ï¼Ÿ', a: '4å…¬å‡500æ¯«å‡', opts: ['4å…¬å‡50æ¯«å‡', '4å…¬å‡500æ¯«å‡', '45å…¬å‡', '450å…¬å‡'], hint: '4500Ã·1000', steps: ['4500 Ã· 1000 = 4...500', 'å•†4 = 4å…¬å‡', 'é¤˜500 = 500æ¯«å‡'] },
                { q: 'å¾æ—©ä¸Š7:25åˆ°ä¸­åˆ12:10ï¼Œå…±å¹¾å°æ™‚å¹¾åˆ†ï¼Ÿ', a: '4å°æ™‚45åˆ†', opts: ['4å°æ™‚35åˆ†', '4å°æ™‚45åˆ†', '4å°æ™‚55åˆ†', '5å°æ™‚15åˆ†'], hint: '12:10 - 7:25', steps: ['12:10 - 7:25', 'åˆ†é˜ï¼š10 - 25 ä¸å¤ æ¸›', 'å€Ÿ1å°æ™‚ï¼š70 - 25 = 45åˆ†', 'å°æ™‚ï¼š11 - 7 = 4å°æ™‚', 'ç­”æ¡ˆï¼š4å°æ™‚45åˆ†'] },
                { q: 'ä¸‹åˆ4:50æ˜¯24æ™‚åˆ¶çš„å¹¾é»å¹¾åˆ†ï¼Ÿ', a: '16:50', opts: ['14:50', '15:50', '16:50', '17:50'], hint: 'ä¸‹åˆè¦+12', steps: ['24æ™‚åˆ¶ï¼šä¸‹åˆè¦åŠ 12', '4 + 12 = 16', 'ç­”æ¡ˆï¼š16:50'] },
                { q: 'å°æ˜8:15å‡ºé–€ï¼Œèµ°äº†2å°æ™‚35åˆ†åˆ°å­¸æ ¡ï¼Œå¹¾é»åˆ°ï¼Ÿ', a: '10:50', opts: ['10:40', '10:45', '10:50', '11:00'], hint: '8:15 + 2:35', steps: ['15 + 35 = 50åˆ†', '8 + 2 = 10é»', 'ç­”æ¡ˆï¼š10:50'] }
            ]
        };

        const levelNames = {
            numbers: 'æ•¸å­—æ˜Ÿçƒ',
            multiply: 'ä¹˜æ³•éŠ€æ²³',
            divide: 'é™¤æ³•é»‘æ´',
            shapes: 'åœ–å½¢å¤ªç©ºç«™',
            time: 'æ™‚é–“èŸ²æ´'
        };

        const levelIcons = {
            numbers: 'ğŸ”¢',
            multiply: 'âœ–ï¸',
            divide: 'â—',
            shapes: 'ğŸ“',
            time: 'â°'
        };

        const levelRequirements = {
            numbers: 0,
            multiply: 50,
            divide: 150,
            shapes: 300,
            time: 500
        };

        const levelTitles = ['æ•¸å­¸æ–°æ‰‹', 'æ˜Ÿéš›è¨ˆç®—å“¡', 'éŠ€æ²³æ•¸å­¸å®¶', 'å®‡å®™è§£é¡Œç‹', 'æ•¸å­¸å°åšå£«', 'æ•¸å­¸å¤ªç©ºäºº'];

        let gameState = {
            playerName: '',
            stars: 0,
            exp: 0,
            level: 1,
            currentLevel: null,
            currentQuestion: 0,
            correctAnswers: 0,
            lives: 3,
            records: [],
            levelProgress: { numbers: 0, multiply: 0, divide: 0, shapes: 0, time: 0 },
            questionResults: []
        };

        function loadGame() {
            const saved = localStorage.getItem('xiaoyongMathGame');
            if (saved) {
                gameState = JSON.parse(saved);
                document.getElementById('nameModal').classList.add('hidden');
                updateUI();
            }
        }

        function saveGame() {
            localStorage.setItem('xiaoyongMathGame', JSON.stringify(gameState));
        }

        function setPlayerName() {
            const name = document.getElementById('playerNameInput').value.trim();
            if (name) {
                playStartSound();
                gameState.playerName = name;
                document.getElementById('nameModal').classList.add('hidden');
                updateUI();
                saveGame();
            } else {
                alert('è«‹è¼¸å…¥ä½ çš„åå­—å–”ï¼');
            }
        }

        function updateUI() {
            document.getElementById('playerName').textContent = gameState.playerName || 'å°è›¹';
            document.getElementById('playerStars').textContent = gameState.stars;
            document.getElementById('playerExp').textContent = gameState.exp;
            document.getElementById('playerLevel').textContent = gameState.level;
            document.getElementById('levelTitle').textContent = levelTitles[Math.min(gameState.level - 1, levelTitles.length - 1)];
            updateLevelLocks();
            updateProgressBars();
            updateRecords();
        }

        function updateLevelLocks() {
            ['multiply', 'divide', 'shapes', 'time'].forEach(level => {
                const card = document.getElementById('level' + level.charAt(0).toUpperCase() + level.slice(1));
                const existingLock = card.querySelector('.lock-overlay');
                if (existingLock) existingLock.remove();
                
                if (gameState.exp < levelRequirements[level]) {
                    card.classList.add('locked');
                    const lockDiv = document.createElement('div');
                    lockDiv.className = 'lock-overlay';
                    lockDiv.textContent = 'ğŸ”’';
                    card.appendChild(lockDiv);
                } else {
                    card.classList.remove('locked');
                }
            });
        }

        function updateProgressBars() {
            Object.keys(gameState.levelProgress).forEach(level => {
                const bar = document.getElementById('progress' + level.charAt(0).toUpperCase() + level.slice(1));
                if (bar) bar.style.width = gameState.levelProgress[level] + '%';
            });
        }

        function updateRecords() {
            const recordsList = document.getElementById('recordsList');
            if (gameState.records.length === 0) {
                recordsList.innerHTML = '<div class="empty-records"><div class="empty-records-icon">ğŸ›¸</div><p>é‚„æ²’æœ‰ç´€éŒ„å–”ï¼å¿«ä¾†æ¢ç´¢æ˜Ÿçƒå§ï¼</p></div>';
            } else {
                recordsList.innerHTML = gameState.records.slice(-10).reverse().map(r => 
                    `<div class="record-item">
                        <div class="record-icon">${r.passed ? 'ğŸ†' : 'ğŸ“–'}</div>
                        <div class="record-info">
                            <div class="record-title">${levelNames[r.level]}</div>
                            <div class="record-date">${r.date}</div>
                        </div>
                        <div class="record-score">${r.score}/10</div>
                    </div>`
                ).join('');
            }
        }

        function startGame(level) {
            if (gameState.exp < levelRequirements[level]) {
                playWrongSound();
                alert(`éœ€è¦ ${levelRequirements[level]} ç¶“é©—å€¼æ‰èƒ½è§£é–ï¼\nç›®å‰ç¶“é©—å€¼ï¼š${gameState.exp}`);
                return;
            }

            playStartSound();
            gameState.currentLevel = level;
            gameState.currentQuestion = 0;
            gameState.correctAnswers = 0;
            gameState.lives = 3;
            gameState.questionResults = [];

            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('gameTitle').textContent = levelIcons[level] + ' ' + levelNames[level];

            showQuestion();
        }

        function showQuestion() {
            const qData = questions[gameState.currentLevel][gameState.currentQuestion];
            
            document.getElementById('questionNum').textContent = gameState.currentQuestion + 1;
            document.getElementById('questionImage').textContent = levelIcons[gameState.currentLevel];
            document.getElementById('questionText').textContent = qData.q;
            document.getElementById('questionHint').textContent = 'ğŸ’¡ æç¤ºï¼š' + qData.hint;
            
            let hearts = '';
            for (let i = 0; i < gameState.lives; i++) hearts += 'ğŸ’œ';
            for (let i = gameState.lives; i < 3; i++) hearts += 'ğŸ–¤';
            document.getElementById('energyHearts').textContent = hearts;

            const shuffled = qData.opts.slice().sort(() => Math.random() - 0.5);
            const grid = document.getElementById('answersGrid');
            grid.innerHTML = '';
            shuffled.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(opt);
                grid.appendChild(btn);
            });
        }

        function checkAnswer(selected) {
            const qData = questions[gameState.currentLevel][gameState.currentQuestion];
            const isCorrect = selected === qData.a;
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === qData.a) btn.classList.add('correct');
                if (btn.textContent === selected && !isCorrect) btn.classList.add('wrong');
            });

            gameState.questionResults.push({
                question: qData.q,
                answer: qData.a,
                hint: qData.hint,
                steps: qData.steps,
                userAnswer: selected,
                isCorrect: isCorrect
            });

            if (isCorrect) {
                gameState.correctAnswers++;
                playCorrectSound();
                setTimeout(() => proceedToNext(), 800);
            } else {
                gameState.lives--;
                playWrongSound();
                setTimeout(() => showWrongFeedback(qData, selected), 600);
            }
        }

        function showWrongFeedback(qData, userAnswer) {
            const stepsHtml = qData.steps.map(s => `<div class="feedback-step">${s}</div>`).join('');
            const html = `
                <div class="wrong-feedback" id="wrongFeedback">
                    <div class="feedback-card">
                        <div class="feedback-icon">ğŸ¤”</div>
                        <div class="feedback-title">è®“æˆ‘å€‘ä¸€èµ·æƒ³ä¸€æƒ³ï¼</div>
                        <div class="feedback-content">
                            <div class="feedback-question">${qData.q}</div>
                            <div class="feedback-answer">âœ¨ ${qData.a} âœ¨</div>
                            <div class="feedback-steps">
                                <div class="feedback-steps-title">ğŸ“ è§£é¡Œæ­¥é©Ÿï¼š</div>
                                ${stepsHtml}
                            </div>
                            <div class="feedback-hint">ğŸ’¡ ${qData.hint}</div>
                        </div>
                        <div class="feedback-your-answer">ä½ çš„ç­”æ¡ˆï¼š<span>${userAnswer}</span></div>
                        <button class="feedback-btn" onclick="closeFeedbackAndProceed()">æˆ‘æ‡‚äº†ï¼ç¹¼çºŒ â†’</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }

        function closeFeedbackAndProceed() {
            const feedback = document.getElementById('wrongFeedback');
            if (feedback) feedback.remove();
            playClickSound();
            proceedToNext();
        }

        function proceedToNext() {
            if (gameState.lives === 0 || gameState.currentQuestion >= 9) {
                showResult();
            } else {
                gameState.currentQuestion++;
                showQuestion();
            }
        }

        function showResult() {
            const passed = gameState.correctAnswers >= 6;
            const starsEarned = gameState.correctAnswers * 10;
            const expEarned = gameState.correctAnswers * 5;

            if (passed) playWinSound(); else playLoseSound();

            gameState.stars += starsEarned;
            gameState.exp += expEarned;
            gameState.level = Math.floor(gameState.exp / 100) + 1;
            gameState.levelProgress[gameState.currentLevel] = Math.max(
                gameState.levelProgress[gameState.currentLevel],
                gameState.correctAnswers * 10
            );

            const now = new Date();
            gameState.records.push({
                level: gameState.currentLevel,
                score: gameState.correctAnswers,
                passed: passed,
                date: `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()}`
            });

            saveGame();

            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';

            document.getElementById('resultIcon').textContent = passed ? 'ğŸ¦‹' : 'ğŸ›';
            document.getElementById('resultTitle').textContent = passed ? 'å¤ªå²å®³äº†ï¼' : 'ç¹¼çºŒåŠ æ²¹ï¼';
            document.getElementById('resultTitle').className = 'result-title ' + (passed ? 'success' : 'fail');
            document.getElementById('resultMessage').textContent = passed ? 
                'ä½ æˆåŠŸå¾æœäº†é€™å€‹æ˜Ÿçƒï¼' : 'å†ç·´ç¿’ä¸€ä¸‹ï¼Œå°è›¹ä¸€å®šå¯ä»¥çš„ï¼';
            document.getElementById('resultCorrect').textContent = gameState.correctAnswers;
            document.getElementById('resultStars').textContent = '+' + starsEarned;
            document.getElementById('resultExp').textContent = '+' + expEarned;

            generateReviewList();
        }

        function generateReviewList() {
            const list = document.getElementById('reviewList');
            const wrong = gameState.questionResults.filter(q => !q.isCorrect);
            const correct = gameState.questionResults.filter(q => q.isCorrect);
            
            let html = '';
            
            if (wrong.length > 0) {
                html += '<div style="color: #EF4444; font-weight: 800; margin-bottom: 10px;">âŒ éœ€è¦åŠ å¼·ï¼š</div>';
                wrong.forEach(q => {
                    html += `
                        <div class="review-item wrong">
                            <div class="review-emoji">ğŸ“</div>
                            <div class="review-content">
                                <div class="review-question">${q.question}</div>
                                <div class="review-answer">æ­£ç¢ºç­”æ¡ˆï¼š${q.answer}</div>
                                <div class="review-your-answer">ä½ çš„ç­”æ¡ˆï¼š${q.userAnswer}</div>
                            </div>
                            <div class="review-status">ğŸ”„</div>
                        </div>
                    `;
                });
            }
            
            if (correct.length > 0) {
                html += '<div style="color: #22C55E; font-weight: 800; margin: 15px 0 10px;">âœ… ç­”å°çš„é¡Œç›®ï¼š</div>';
                correct.forEach(q => {
                    html += `
                        <div class="review-item correct">
                            <div class="review-emoji">âœ¨</div>
                            <div class="review-content">
                                <div class="review-question">${q.question}</div>
                                <div class="review-answer">ç­”æ¡ˆï¼š${q.answer}</div>
                            </div>
                            <div class="review-status">â­</div>
                        </div>
                    `;
                });
            }
            
            list.innerHTML = html;
        }

        function restartGame() {
            playClickSound();
            startGame(gameState.currentLevel);
        }

        function backToMain() {
            playClickSound();
            document.getElementById('mainScreen').style.display = 'block';
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'none';
            updateUI();
        }

        loadGame();

        document.getElementById('playerNameInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') setPlayerName();
        });
    </script>
</body>
</html>
