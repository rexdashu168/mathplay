<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å°è›¹çš„æ•¸å­¸æ˜Ÿçƒå†’éšª</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&display=swap');
        
        :root {
            --space-dark: #0F172A;
            --space-blue: #1E3A5F;
            --blue: #3B82F6;
            --purple: #8B5CF6;
            --purple-dark: #6D28D9;
            --cyan: #06B6D4;
            --orange: #F97316;
            --yellow: #FACC15;
            --green: #22C55E;
            --pink: #EC4899;
            --white: #FFFFFF;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Nunito', sans-serif;
            min-height: 100vh;
            overflow-x: hidden;
            background: linear-gradient(180deg, 
                #0F172A 0%, 
                #1E293B 30%,
                #1E3A5F 60%,
                #312E81 100%);
            background-attachment: fixed;
            position: relative;
        }

        /* æ˜Ÿç©ºèƒŒæ™¯ */
        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0;
        }

        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle ease-in-out infinite;
        }

        @keyframes twinkle {
            0%, 100% { opacity: 0.3; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.3); }
        }

        /* æµæ˜Ÿ */
        .meteor {
            position: fixed;
            width: 2px;
            height: 2px;
            background: linear-gradient(45deg, white, transparent);
            box-shadow: 0 0 10px 2px rgba(255,255,255,0.5);
            animation: shooting 4s linear infinite;
            opacity: 0;
            z-index: 0;
        }

        .meteor:nth-child(1) { top: 10%; left: 20%; animation-delay: 0s; }
        .meteor:nth-child(2) { top: 20%; left: 60%; animation-delay: 2s; }
        .meteor:nth-child(3) { top: 5%; left: 80%; animation-delay: 4s; }

        @keyframes shooting {
            0% { transform: translateX(0) translateY(0); opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { transform: translateX(300px) translateY(300px); opacity: 0; }
        }

        /* æ¼‚æµ®æ˜Ÿçƒ */
        .planets {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1;
        }

        .planet {
            position: absolute;
            animation: planetFloat 8s ease-in-out infinite;
            font-size: 2.5rem;
            filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.5));
        }

        .planet:nth-child(1) { top: 15%; right: 8%; animation-delay: 0s; }
        .planet:nth-child(2) { top: 45%; left: 5%; animation-delay: 2s; font-size: 2rem; }
        .planet:nth-child(3) { top: 70%; right: 5%; animation-delay: 4s; font-size: 1.8rem; }
        .planet:nth-child(4) { top: 25%; left: 3%; animation-delay: 1s; font-size: 1.5rem; }

        @keyframes planetFloat {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(10deg); }
        }

        /* ä¸»å®¹å™¨ */
        .container {
            max-width: 900px;
            margin: 0 auto;
            padding: 20px;
            padding-bottom: 100px;
            position: relative;
            z-index: 2;
        }

        /* æ¨™é¡Œå€ */
        .header {
            text-align: center;
            padding: 35px 25px;
            background: linear-gradient(145deg, #3B82F6, #8B5CF6, #6D28D9);
            background-size: 200% 200%;
            animation: gradientShift 8s ease infinite;
            border-radius: 30px;
            margin-bottom: 25px;
            box-shadow: 
                0 15px 50px rgba(139, 92, 246, 0.5),
                0 0 100px rgba(59, 130, 246, 0.3),
                0 0 0 1px rgba(255,255,255,0.1) inset;
            position: relative;
            overflow: hidden;
        }

        @keyframes gradientShift {
            0%, 100% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.2) 0%, transparent 60%);
            animation: shimmer 4s ease-in-out infinite;
        }

        @keyframes shimmer {
            0%, 100% { transform: rotate(0deg) scale(1); opacity: 0.3; }
            50% { transform: rotate(180deg) scale(1.2); opacity: 0.6; }
        }

        .header h1 {
            font-size: 2.4rem;
            font-weight: 900;
            color: var(--white);
            text-shadow: 
                0 0 30px rgba(255,255,255,0.5),
                3px 3px 0 rgba(0,0,0,0.2);
            position: relative;
            letter-spacing: 3px;
        }

        .header .mascot {
            font-size: 4.5rem;
            display: block;
            margin-bottom: 10px;
            animation: rocketBounce 3s ease-in-out infinite;
            filter: drop-shadow(0 10px 30px rgba(0,0,0,0.3));
        }

        @keyframes rocketBounce {
            0%, 100% { transform: translateY(0) rotate(-5deg); }
            50% { transform: translateY(-20px) rotate(5deg); }
        }

        .header .subtitle {
            color: rgba(255,255,255,0.9);
            font-size: 1.15rem;
            margin-top: 12px;
            font-weight: 700;
        }

        /* ç©å®¶è³‡è¨Šå¡ */
        .player-card {
            background: linear-gradient(135deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 25px;
            padding: 22px 28px;
            margin-bottom: 25px;
            box-shadow: 
                0 10px 40px rgba(0,0,0,0.3),
                0 0 0 1px rgba(139, 92, 246, 0.3) inset;
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            backdrop-filter: blur(10px);
        }

        .player-avatar {
            width: 75px;
            height: 75px;
            background: linear-gradient(135deg, #3B82F6, #8B5CF6);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.8rem;
            box-shadow: 
                0 0 30px rgba(139, 92, 246, 0.5),
                0 0 0 3px rgba(255,255,255,0.2) inset;
            animation: avatarGlow 3s ease-in-out infinite;
        }

        @keyframes avatarGlow {
            0%, 100% { box-shadow: 0 0 30px rgba(139, 92, 246, 0.5), 0 0 0 3px rgba(255,255,255,0.2) inset; }
            50% { box-shadow: 0 0 50px rgba(139, 92, 246, 0.8), 0 0 0 3px rgba(255,255,255,0.3) inset; }
        }

        .player-info {
            flex: 1;
            min-width: 150px;
        }

        .player-name {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 5px;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .player-level {
            color: rgba(255,255,255,0.7);
            font-weight: 700;
        }

        .level-badge {
            background: linear-gradient(135deg, var(--yellow), var(--orange));
            padding: 3px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            color: #1E293B;
            font-weight: 800;
            box-shadow: 0 0 15px rgba(250, 204, 21, 0.5);
        }

        .player-stats {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .stat-box {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.3), rgba(139, 92, 246, 0.3));
            padding: 14px 20px;
            border-radius: 18px;
            text-align: center;
            min-width: 90px;
            border: 1px solid rgba(139, 92, 246, 0.3);
            transition: all 0.3s ease;
        }

        .stat-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(139, 92, 246, 0.3);
        }

        .stat-box.stars {
            background: linear-gradient(135deg, rgba(250, 204, 21, 0.2), rgba(249, 115, 22, 0.2));
            border-color: rgba(250, 204, 21, 0.3);
        }

        .stat-box.exp {
            background: linear-gradient(135deg, rgba(6, 182, 212, 0.2), rgba(59, 130, 246, 0.2));
            border-color: rgba(6, 182, 212, 0.3);
        }

        .stat-number {
            font-size: 1.6rem;
            font-weight: 900;
            color: var(--white);
        }

        .stat-label {
            font-size: 0.8rem;
            color: rgba(255,255,255,0.7);
            font-weight: 700;
            margin-top: 2px;
        }

        /* é—œå¡é¸æ“‡å€ */
        .levels-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.7rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            text-shadow: 0 0 20px rgba(139, 92, 246, 0.5);
        }

        .levels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(165px, 1fr));
            gap: 18px;
        }

        .level-card {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 24px;
            padding: 22px;
            text-align: center;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
        }

        .level-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 6px;
            border-radius: 3px 3px 0 0;
        }

        .level-card.numbers::before { background: linear-gradient(90deg, #3B82F6, #60A5FA); }
        .level-card.multiply::before { background: linear-gradient(90deg, #8B5CF6, #A78BFA); }
        .level-card.divide::before { background: linear-gradient(90deg, #6D28D9, #7C3AED); }
        .level-card.shapes::before { background: linear-gradient(90deg, #06B6D4, #22D3EE); }
        .level-card.time::before { background: linear-gradient(90deg, #F97316, #FB923C); }

        .level-card:hover {
            transform: translateY(-12px) scale(1.02);
        }

        .level-card.numbers:hover { border-color: #3B82F6; box-shadow: 0 20px 50px rgba(59, 130, 246, 0.4); }
        .level-card.multiply:hover { border-color: #8B5CF6; box-shadow: 0 20px 50px rgba(139, 92, 246, 0.4); }
        .level-card.divide:hover { border-color: #6D28D9; box-shadow: 0 20px 50px rgba(109, 40, 217, 0.4); }
        .level-card.shapes:hover { border-color: #06B6D4; box-shadow: 0 20px 50px rgba(6, 182, 212, 0.4); }
        .level-card.time:hover { border-color: #F97316; box-shadow: 0 20px 50px rgba(249, 115, 22, 0.4); }

        .level-card.locked {
            opacity: 0.5;
            cursor: not-allowed;
            filter: grayscale(50%);
        }

        .level-card.locked:hover {
            transform: none;
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
        }

        .level-icon {
            font-size: 3.2rem;
            margin-bottom: 12px;
            display: block;
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.3));
            transition: transform 0.3s ease;
        }

        .level-card:hover .level-icon {
            transform: scale(1.2) rotate(10deg);
        }

        .level-name {
            font-size: 1.15rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 6px;
        }

        .level-desc {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.6);
            font-weight: 600;
        }

        .level-progress {
            margin-top: 12px;
            height: 10px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        .level-progress-bar {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
        }

        .level-progress-bar::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            animation: progressShine 2s infinite;
        }

        @keyframes progressShine {
            from { transform: translateX(-100%); }
            to { transform: translateX(100%); }
        }

        .numbers .level-progress-bar { background: linear-gradient(90deg, #3B82F6, #60A5FA); }
        .multiply .level-progress-bar { background: linear-gradient(90deg, #8B5CF6, #A78BFA); }
        .divide .level-progress-bar { background: linear-gradient(90deg, #6D28D9, #7C3AED); }
        .shapes .level-progress-bar { background: linear-gradient(90deg, #06B6D4, #22D3EE); }
        .time .level-progress-bar { background: linear-gradient(90deg, #F97316, #FB923C); }

        .lock-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, 0.7);
            backdrop-filter: blur(3px);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border-radius: 24px;
        }

        /* éŠæˆ²å€ */
        .game-area {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.95), rgba(15, 23, 42, 0.95));
            border-radius: 30px;
            padding: 35px;
            box-shadow: 
                0 15px 50px rgba(0,0,0,0.4),
                0 0 0 1px rgba(139, 92, 246, 0.2) inset;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 28px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .game-title {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--white);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .game-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .info-badge {
            background: linear-gradient(135deg, var(--purple), var(--blue));
            padding: 10px 18px;
            border-radius: 20px;
            font-weight: 800;
            color: white;
            font-size: 0.95rem;
            box-shadow: 0 4px 15px rgba(139, 92, 246, 0.4);
        }

        .energy-hearts {
            font-size: 1.6rem;
            letter-spacing: 6px;
            filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.5));
        }

        .question-area {
            text-align: center;
            padding: 40px 30px;
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 28px;
            margin-bottom: 28px;
            border: 1px solid rgba(139, 92, 246, 0.2);
            position: relative;
        }

        .question-image {
            font-size: 5rem;
            margin-bottom: 20px;
            animation: questionPulse 2s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(139, 92, 246, 0.5));
        }

        @keyframes questionPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .question-text {
            font-size: 1.8rem;
            color: var(--white);
            font-weight: 800;
            margin-bottom: 15px;
            line-height: 1.4;
        }

        .question-hint {
            font-size: 1rem;
            color: rgba(255,255,255,0.6);
            font-weight: 600;
            background: rgba(255,255,255,0.1);
            padding: 10px 20px;
            border-radius: 15px;
            display: inline-block;
        }

        .answers-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            margin-bottom: 25px;
        }

        .answer-btn {
            padding: 22px;
            font-size: 1.4rem;
            font-weight: 800;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 22px;
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            color: var(--white);
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            font-family: 'Nunito', sans-serif;
            position: relative;
            overflow: hidden;
        }

        .answer-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s ease;
        }

        .answer-btn:hover::before {
            left: 100%;
        }

        .answer-btn:hover {
            border-color: var(--purple);
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 40px rgba(139, 92, 246, 0.4);
        }

        .answer-btn.correct {
            background: linear-gradient(145deg, #22C55E, #16A34A);
            border-color: #22C55E;
            animation: correctPulse 0.6s ease;
            box-shadow: 0 0 40px rgba(34, 197, 94, 0.6);
        }

        .answer-btn.wrong {
            background: linear-gradient(145deg, #EF4444, #DC2626);
            border-color: #EF4444;
            animation: wrongShake 0.6s ease;
            box-shadow: 0 0 40px rgba(239, 68, 68, 0.6);
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.08); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            20% { transform: translateX(-12px); }
            40% { transform: translateX(12px); }
            60% { transform: translateX(-8px); }
            80% { transform: translateX(8px); }
        }

        .back-btn {
            background: linear-gradient(145deg, #475569, #334155);
            color: white;
            border: none;
            padding: 14px 35px;
            border-radius: 18px;
            font-size: 1.05rem;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        /* ç­”éŒ¯æç¤º */
        .wrong-feedback {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.3s ease;
        }

        .feedback-card {
            background: linear-gradient(145deg, #1E293B, #0F172A);
            border-radius: 30px;
            padding: 35px;
            max-width: 500px;
            width: 100%;
            text-align: center;
            box-shadow: 
                0 25px 80px rgba(0,0,0,0.5),
                0 0 0 1px rgba(139, 92, 246, 0.3) inset;
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        @keyframes modalPop {
            from { transform: scale(0.7) translateY(30px); opacity: 0; }
            to { transform: scale(1) translateY(0); opacity: 1; }
        }

        .feedback-icon {
            font-size: 4rem;
            margin-bottom: 15px;
        }

        .feedback-title {
            font-size: 1.5rem;
            font-weight: 900;
            color: var(--orange);
            margin-bottom: 20px;
        }

        .feedback-content {
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            border-radius: 20px;
            padding: 25px;
            margin-bottom: 20px;
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .feedback-question {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.8);
            margin-bottom: 15px;
        }

        .feedback-answer {
            font-size: 2.5rem;
            font-weight: 900;
            color: var(--green);
            margin-bottom: 15px;
            text-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
        }

        .feedback-steps {
            background: rgba(0,0,0,0.3);
            border-radius: 15px;
            padding: 20px;
            text-align: left;
            margin-bottom: 15px;
        }

        .feedback-steps-title {
            font-size: 1rem;
            color: var(--cyan);
            font-weight: 800;
            margin-bottom: 10px;
        }

        .feedback-step {
            color: rgba(255,255,255,0.8);
            font-size: 1rem;
            margin: 8px 0;
            padding-left: 20px;
            position: relative;
        }

        .feedback-step::before {
            content: 'â†’';
            position: absolute;
            left: 0;
            color: var(--yellow);
        }

        .feedback-hint {
            background: rgba(250, 204, 21, 0.1);
            padding: 12px 18px;
            border-radius: 15px;
            font-size: 1rem;
            color: var(--yellow);
            font-weight: 600;
            border: 1px solid rgba(250, 204, 21, 0.2);
        }

        .feedback-your-answer {
            color: rgba(255,255,255,0.6);
            margin-top: 15px;
            font-weight: 600;
        }

        .feedback-your-answer span {
            color: #EF4444;
            font-weight: 800;
        }

        .feedback-btn {
            background: linear-gradient(145deg, var(--purple), var(--blue));
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 20px;
            font-size: 1.1rem;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(139, 92, 246, 0.4);
        }

        .feedback-btn:hover {
            transform: translateY(-3px) scale(1.05);
        }

        /* çµæœç•«é¢ */
        .result-screen {
            text-align: center;
            padding: 40px 20px;
        }

        .result-icon {
            font-size: 7rem;
            margin-bottom: 25px;
            animation: resultBounce 1s ease infinite;
            filter: drop-shadow(0 0 40px rgba(139, 92, 246, 0.6));
        }

        @keyframes resultBounce {
            0%, 100% { transform: translateY(0) rotate(0deg); }
            25% { transform: translateY(-20px) rotate(-5deg); }
            75% { transform: translateY(-10px) rotate(5deg); }
        }

        .result-title {
            font-size: 2.2rem;
            font-weight: 900;
            margin-bottom: 15px;
        }

        .result-title.success {
            color: var(--green);
            text-shadow: 0 0 30px rgba(34, 197, 94, 0.5);
        }

        .result-title.fail {
            color: var(--orange);
            text-shadow: 0 0 30px rgba(249, 115, 22, 0.5);
        }

        .result-message {
            font-size: 1.15rem;
            color: rgba(255,255,255,0.7);
            font-weight: 600;
        }

        .result-stats {
            display: flex;
            justify-content: center;
            gap: 25px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .result-stat {
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.2), rgba(139, 92, 246, 0.2));
            padding: 22px 32px;
            border-radius: 22px;
            border: 1px solid rgba(139, 92, 246, 0.3);
        }

        .result-stat-number {
            font-size: 2.2rem;
            font-weight: 900;
            color: var(--white);
        }

        .result-stat-label {
            font-size: 0.95rem;
            color: rgba(255,255,255,0.6);
            font-weight: 700;
        }

        /* ç¸½è¤‡ç¿’å€ */
        .review-section {
            margin-top: 30px;
            text-align: left;
        }

        .review-title {
            font-size: 1.4rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 20px;
            text-align: center;
        }

        .review-list {
            display: grid;
            gap: 12px;
            max-height: 350px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .review-list::-webkit-scrollbar {
            width: 8px;
        }

        .review-list::-webkit-scrollbar-track {
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .review-list::-webkit-scrollbar-thumb {
            background: linear-gradient(180deg, var(--purple), var(--blue));
            border-radius: 10px;
        }

        .review-item {
            display: flex;
            align-items: center;
            padding: 15px 18px;
            border-radius: 18px;
            gap: 15px;
            transition: all 0.3s ease;
        }

        .review-item.correct {
            background: linear-gradient(145deg, rgba(34, 197, 94, 0.15), rgba(22, 163, 74, 0.15));
            border: 1px solid rgba(34, 197, 94, 0.3);
        }

        .review-item.wrong {
            background: linear-gradient(145deg, rgba(239, 68, 68, 0.15), rgba(220, 38, 38, 0.15));
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        .review-item:hover {
            transform: translateX(5px);
        }

        .review-emoji {
            font-size: 2rem;
            flex-shrink: 0;
        }

        .review-content {
            flex: 1;
        }

        .review-question {
            font-size: 1.1rem;
            font-weight: 800;
            color: var(--white);
        }

        .review-answer {
            font-size: 0.95rem;
            color: var(--green);
            font-weight: 700;
        }

        .review-your-answer {
            font-size: 0.85rem;
            color: #EF4444;
            font-weight: 600;
        }

        .review-status {
            font-size: 1.5rem;
        }

        .result-buttons {
            display: flex;
            gap: 18px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 25px;
        }

        .result-btn {
            padding: 16px 40px;
            border-radius: 22px;
            font-size: 1.15rem;
            font-weight: 800;
            border: none;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
        }

        .result-btn.primary {
            background: linear-gradient(145deg, var(--purple), var(--blue));
            color: white;
            box-shadow: 0 8px 30px rgba(139, 92, 246, 0.4);
        }

        .result-btn.secondary {
            background: transparent;
            border: 2px solid var(--purple);
            color: var(--purple);
        }

        .result-btn:hover {
            transform: translateY(-5px) scale(1.05);
        }

        /* å­¸ç¿’ç´€éŒ„å€ */
        .records-section {
            background: linear-gradient(145deg, rgba(30, 41, 59, 0.9), rgba(15, 23, 42, 0.9));
            border-radius: 28px;
            padding: 28px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.3);
            border: 1px solid rgba(139, 92, 246, 0.2);
        }

        .records-list {
            max-height: 320px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .record-item {
            display: flex;
            align-items: center;
            padding: 16px 18px;
            border-radius: 18px;
            margin-bottom: 12px;
            background: linear-gradient(145deg, rgba(59, 130, 246, 0.1), rgba(139, 92, 246, 0.1));
            gap: 15px;
            transition: all 0.3s ease;
            border: 1px solid rgba(139, 92, 246, 0.1);
        }

        .record-item:hover {
            transform: translateX(8px);
            border-color: rgba(139, 92, 246, 0.3);
        }

        .record-icon {
            font-size: 2.2rem;
        }

        .record-info {
            flex: 1;
        }

        .record-title {
            font-weight: 800;
            color: var(--white);
            font-size: 1.05rem;
        }

        .record-date {
            font-size: 0.85rem;
            color: rgba(255,255,255,0.5);
            font-weight: 600;
        }

        .record-score {
            font-size: 1.3rem;
            font-weight: 900;
            color: var(--yellow);
            background: rgba(250, 204, 21, 0.1);
            padding: 6px 14px;
            border-radius: 12px;
        }

        .empty-records {
            text-align: center;
            padding: 50px;
            color: rgba(255,255,255,0.5);
        }

        .empty-records-icon {
            font-size: 5rem;
            margin-bottom: 18px;
            opacity: 0.5;
        }

        /* éŸ³é‡æ§åˆ¶ */
        .sound-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            background: linear-gradient(145deg, #1E293B, #0F172A);
            border: 2px solid var(--purple);
            font-size: 1.6rem;
            cursor: pointer;
            z-index: 100;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.4);
            transition: all 0.3s ease;
        }

        .sound-toggle:hover {
            transform: scale(1.15) rotate(10deg);
        }

        /* å½ˆçª— */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(15, 23, 42, 0.9);
            backdrop-filter: blur(10px);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
        }

        .modal-overlay.hidden {
            display: none;
        }

        .modal {
            background: linear-gradient(145deg, #1E293B, #0F172A);
            border-radius: 35px;
            padding: 45px;
            text-align: center;
            max-width: 420px;
            width: 100%;
            animation: modalPop 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
            box-shadow: 
                0 25px 80px rgba(0,0,0,0.5),
                0 0 0 1px rgba(139, 92, 246, 0.3) inset,
                0 0 100px rgba(139, 92, 246, 0.2);
        }

        .modal-icon {
            font-size: 5rem;
            margin-bottom: 18px;
            animation: rocketBounce 3s ease-in-out infinite;
        }

        .modal-title {
            font-size: 2rem;
            font-weight: 900;
            color: var(--white);
            margin-bottom: 12px;
        }

        .modal-text {
            color: rgba(255,255,255,0.7);
            margin-bottom: 25px;
            font-weight: 600;
            font-size: 1.1rem;
        }

        .modal-input {
            width: 100%;
            padding: 18px 24px;
            border: 2px solid rgba(139, 92, 246, 0.3);
            border-radius: 18px;
            font-size: 1.2rem;
            font-family: 'Nunito', sans-serif;
            font-weight: 700;
            text-align: center;
            margin-bottom: 25px;
            background: rgba(255,255,255,0.05);
            color: var(--white);
            transition: all 0.3s ease;
        }

        .modal-input:focus {
            outline: none;
            border-color: var(--purple);
            box-shadow: 0 0 30px rgba(139, 92, 246, 0.3);
        }

        .modal-input::placeholder {
            color: rgba(255,255,255,0.4);
        }

        .modal-btn {
            background: linear-gradient(145deg, var(--purple), var(--blue));
            color: white;
            border: none;
            padding: 18px 50px;
            border-radius: 22px;
            font-size: 1.2rem;
            font-weight: 800;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            transition: all 0.3s ease;
            box-shadow: 0 10px 35px rgba(139, 92, 246, 0.5);
        }

        .modal-btn:hover {
            transform: translateY(-5px) scale(1.05);
        }

        /* éŸ¿æ‡‰å¼ */
        @media (max-width: 600px) {
            .header h1 { font-size: 1.8rem; }
            .header .mascot { font-size: 3.5rem; }
            .player-card { flex-direction: column; text-align: center; }
            .answers-grid { grid-template-columns: 1fr; }
            .question-text { font-size: 1.4rem; }
            .question-image { font-size: 4rem; }
        }
    </style>
</head>
<body>
    <button class="sound-toggle" id="soundToggle" onclick="toggleSound()">ğŸ”Š</button>

    <!-- æ˜Ÿç©ºèƒŒæ™¯ -->
    <div class="stars" id="starsContainer"></div>

    <!-- æµæ˜Ÿ -->
    <div class="meteor"></div>
    <div class="meteor"></div>
    <div class="meteor"></div>

    <!-- æ¼‚æµ®æ˜Ÿçƒ -->
    <div class="planets">
        <span class="planet">ğŸª</span>
        <span class="planet">ğŸŒ™</span>
        <span class="planet">â­</span>
        <span class="planet">âœ¨</span>
    </div>

    <!-- åå­—è¼¸å…¥å½ˆçª— -->
    <div class="modal-overlay" id="nameModal">
        <div class="modal">
            <div class="modal-icon">ğŸš€</div>
            <h2 class="modal-title">æ­¡è¿ä¾†åˆ°æ•¸å­¸æ˜Ÿçƒï¼</h2>
            <p class="modal-text">å°è›¹æº–å‚™å¥½æ¢ç´¢æ•¸å­¸å®‡å®™äº†å—ï¼Ÿ</p>
            <input type="text" class="modal-input" id="playerNameInput" placeholder="è¼¸å…¥ä½ çš„åå­—..." maxlength="10">
            <button class="modal-btn" onclick="setPlayerName()">ç™¼å°„å‡ç©ºï¼ğŸš€</button>
        </div>
    </div>

    <div class="container">
        <!-- æ¨™é¡Œ -->
        <header class="header">
            <span class="mascot">ğŸš€</span>
            <h1>å°è›¹çš„æ•¸å­¸æ˜Ÿçƒå†’éšª</h1>
            <p class="subtitle">æ­ä¸Šç«ç®­ï¼Œä¸€èµ·æ¢ç´¢æ•¸å­¸çš„å®‡å®™å§ï¼</p>
        </header>

        <!-- ç©å®¶è³‡è¨Š -->
        <div class="player-card">
            <div class="player-avatar">ğŸ›</div>
            <div class="player-info">
                <div class="player-name" id="playerName">å°è›¹</div>
                <div class="player-level">
                    ç­‰ç´šï¼š<span class="level-badge">Lv.<span id="playerLevel">1</span></span>
                    <span id="levelTitle">æ•¸å­¸æ–°æ‰‹</span>
                </div>
            </div>
            <div class="player-stats">
                <div class="stat-box stars">
                    <div class="stat-number" id="playerStars">0</div>
                    <div class="stat-label">â­ æ˜Ÿæ˜Ÿå¹£</div>
                </div>
                <div class="stat-box exp">
                    <div class="stat-number" id="playerExp">0</div>
                    <div class="stat-label">ğŸš€ ç¶“é©—å€¼</div>
                </div>
            </div>
        </div>

        <!-- ä¸»ç•«é¢ -->
        <div id="mainScreen">
            <div class="levels-section">
                <h2 class="section-title">ğŸŒŒ é¸æ“‡æ˜Ÿçƒ</h2>
                <div class="levels-grid">
                    <div class="level-card numbers" onclick="startGame('numbers')">
                        <span class="level-icon">ğŸ”¢</span>
                        <div class="level-name">æ•¸å­—æ˜Ÿçƒ</div>
                        <div class="level-desc">åŠ æ¸›æ³•ç·´ç¿’</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressNumbers" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card multiply" id="levelMultiply" onclick="startGame('multiply')">
                        <span class="level-icon">âœ–ï¸</span>
                        <div class="level-name">ä¹˜æ³•éŠ€æ²³</div>
                        <div class="level-desc">ä¹ä¹ä¹˜æ³•è¡¨</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressMultiply" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card divide" id="levelDivide" onclick="startGame('divide')">
                        <span class="level-icon">â—</span>
                        <div class="level-name">é™¤æ³•é»‘æ´</div>
                        <div class="level-desc">é™¤æ³•åŸºç¤</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressDivide" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card shapes" id="levelShapes" onclick="startGame('shapes')">
                        <span class="level-icon">ğŸ“</span>
                        <div class="level-name">åœ–å½¢å¤ªç©ºç«™</div>
                        <div class="level-desc">åœ–å½¢èˆ‡å‘¨é•·</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressShapes" style="width: 0%"></div>
                        </div>
                    </div>
                    <div class="level-card time" id="levelTime" onclick="startGame('time')">
                        <span class="level-icon">â°</span>
                        <div class="level-name">æ™‚é–“èŸ²æ´</div>
                        <div class="level-desc">æ™‚é–“èˆ‡å®¹é‡</div>
                        <div class="level-progress">
                            <div class="level-progress-bar" id="progressTime" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="records-section">
                <h2 class="section-title">ğŸ“Š æ¢éšªç´€éŒ„</h2>
                <div class="records-list" id="recordsList">
                    <div class="empty-records">
                        <div class="empty-records-icon">ğŸ›¸</div>
                        <p>é‚„æ²’æœ‰ç´€éŒ„å–”ï¼å¿«ä¾†æ¢ç´¢æ˜Ÿçƒå§ï¼</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- éŠæˆ²å€ -->
        <div class="game-area" id="gameArea">
            <div class="game-header">
                <h2 class="game-title" id="gameTitle">ğŸ”¢ æ•¸å­—æ˜Ÿçƒ</h2>
                <div class="game-info">
                    <div class="info-badge">é¡Œç›®ï¼š<span id="questionNum">1</span>/10</div>
                    <div class="energy-hearts" id="energyHearts">ğŸ’œğŸ’œğŸ’œ</div>
                </div>
            </div>
            
            <div class="question-area">
                <div class="question-image" id="questionImage">ğŸ”¢</div>
                <div class="question-text" id="questionText">125 + 234 = ?</div>
                <div class="question-hint" id="questionHint">ğŸ’¡ æç¤ºï¼šå…ˆç®—å€‹ä½æ•¸</div>
            </div>

            <div class="answers-grid" id="answersGrid">
                <button class="answer-btn">359</button>
                <button class="answer-btn">349</button>
                <button class="answer-btn">369</button>
                <button class="answer-btn">339</button>
            </div>

            <button class="back-btn" onclick="backToMain()">â† è¿”å›ä¸»ç•«é¢</button>
        </div>

        <!-- çµæœç•«é¢ -->
        <div class="game-area" id="resultScreen" style="display: none;">
            <div class="result-screen">
                <div class="result-icon" id="resultIcon">ğŸ‰</div>
                <h2 class="result-title success" id="resultTitle">å¤ªå²å®³äº†ï¼</h2>
                <p class="result-message" id="resultMessage">ä½ æˆåŠŸå¾æœäº†é€™å€‹æ˜Ÿçƒï¼</p>
                
                <div class="result-stats">
                    <div class="result-stat">
                        <div class="result-stat-number" id="resultCorrect">0</div>
                        <div class="result-stat-label">ç­”å°é¡Œæ•¸</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-number" id="resultStars">+0</div>
                        <div class="result-stat-label">æ˜Ÿæ˜Ÿå¹£</div>
                    </div>
                    <div class="result-stat">
                        <div class="result-stat-number" id="resultExp">+0</div>
                        <div class="result-stat-label">ç¶“é©—å€¼</div>
                    </div>
                </div>

                <div class="review-section">
                    <h3 class="review-title">ğŸ“– ç¸½è¤‡ç¿’æ™‚é–“</h3>
                    <div class="review-list" id="reviewList"></div>
                </div>

                <div class="result-buttons">
                    <button class="result-btn primary" onclick="restartGame()">å†ç©ä¸€æ¬¡ ğŸ”„</button>
                    <button class="result-btn secondary" onclick="backToMain()">è¿”å›ä¸»ç•«é¢</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ç”Ÿæˆæ˜Ÿæ˜ŸèƒŒæ™¯
        function createStars() {
            const container = document.getElementById('starsContainer');
            for (let i = 0; i < 100; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDuration = (Math.random() * 3 + 2) + 's';
                star.style.animationDelay = Math.random() * 2 + 's';
                container.appendChild(star);
            }
        }
        createStars();

        // éŸ³æ•ˆç³»çµ±
        const AudioContext = window.AudioContext || window.webkitAudioContext;
        let audioCtx = null;
        let soundEnabled = true;

        function initAudio() {
            if (!audioCtx) audioCtx = new AudioContext();
        }

        function toggleSound() {
            soundEnabled = !soundEnabled;
            document.getElementById('soundToggle').textContent = soundEnabled ? 'ğŸ”Š' : 'ğŸ”‡';
            if (soundEnabled) playClickSound();
        }

        function playCorrectSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [523.25, 659.25, 783.99];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                osc.frequency.setValueAtTime(freq, audioCtx.currentTime + i * 0.1);
                gain.gain.setValueAtTime(0.3, audioCtx.currentTime + i * 0.1);
                gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + i * 0.1 + 0.2);
                osc.type = 'sine';
                osc.start(audioCtx.currentTime + i * 0.1);
                osc.stop(audioCtx.currentTime + i * 0.1 + 0.2);
            });
        }

        function playWrongSound() {
            if (!soundEnabled) return;
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(200, audioCtx.currentTime);
            osc.frequency.linearRampToValueAtTime(150, audioCtx.currentTime + 0.2);
            gain.gain.setValueAtTime(0.3, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.3);
            osc.type = 'sawtooth';
            osc.start();
            osc.stop(audioCtx.currentTime + 0.3);
        }

        function playClickSound() {
            if (!soundEnabled) return;
            initAudio();
            const osc = audioCtx.createOscillator();
            const gain = audioCtx.createGain();
            osc.connect(gain);
            gain.connect(audioCtx.destination);
            osc.frequency.setValueAtTime(800, audioCtx.currentTime);
            gain.gain.setValueAtTime(0.2, audioCtx.currentTime);
            gain.gain.linearRampToValueAtTime(0.01, audioCtx.currentTime + 0.1);
            osc.type = 'sine';
            osc.start();
            osc.stop(audioCtx.currentTime + 0.1);
        }

        function playStartSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [261.63, 329.63, 392.00, 523.25];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const t = audioCtx.currentTime + i * 0.1;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0.25, t);
                gain.gain.linearRampToValueAtTime(0.01, t + 0.15);
                osc.type = 'sine';
                osc.start(t);
                osc.stop(t + 0.15);
            });
        }

        function playWinSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [523.25, 587.33, 659.25, 698.46, 783.99, 880, 987.77, 1046.50];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const t = audioCtx.currentTime + i * 0.08;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.linearRampToValueAtTime(0.01, t + 0.12);
                osc.type = 'sine';
                osc.start(t);
                osc.stop(t + 0.12);
            });
        }

        function playLoseSound() {
            if (!soundEnabled) return;
            initAudio();
            const notes = [400, 350, 300, 250];
            notes.forEach((freq, i) => {
                const osc = audioCtx.createOscillator();
                const gain = audioCtx.createGain();
                osc.connect(gain);
                gain.connect(audioCtx.destination);
                const t = audioCtx.currentTime + i * 0.15;
                osc.frequency.setValueAtTime(freq, t);
                gain.gain.setValueAtTime(0.2, t);
                gain.gain.linearRampToValueAtTime(0.01, t + 0.2);
                osc.type = 'triangle';
                osc.start(t);
                osc.stop(t + 0.2);
            });
        }

        // é¡Œç›®è³‡æ–™åº«
        const questions = {
            numbers: [
                { q: '125 + 234 = ?', a: '359', opts: ['349', '359', '369', '379'], hint: 'å€‹ä½5+4=9ï¼Œåä½2+3=5', steps: ['å€‹ä½ï¼š5 + 4 = 9', 'åä½ï¼š2 + 3 = 5', 'ç™¾ä½ï¼š1 + 2 = 3', 'ç­”æ¡ˆï¼š359'] },
                { q: '467 - 123 = ?', a: '344', opts: ['334', '344', '354', '364'], hint: 'æ¯ä½æ•¸å­—å„è‡ªç›¸æ¸›', steps: ['å€‹ä½ï¼š7 - 3 = 4', 'åä½ï¼š6 - 2 = 4', 'ç™¾ä½ï¼š4 - 1 = 3', 'ç­”æ¡ˆï¼š344'] },
                { q: '368 + 245 = ?', a: '613', opts: ['603', '613', '623', '633'], hint: '8+5=13è¦é€²ä½', steps: ['å€‹ä½ï¼š8 + 5 = 13ï¼ˆé€²ä½1ï¼‰', 'åä½ï¼š6 + 4 + 1 = 11ï¼ˆé€²ä½1ï¼‰', 'ç™¾ä½ï¼š3 + 2 + 1 = 6', 'ç­”æ¡ˆï¼š613'] },
                { q: '800 - 356 = ?', a: '444', opts: ['434', '444', '454', '544'], hint: 'è¦é€£çºŒå€Ÿä½', steps: ['å¾800å€Ÿä½è®Šæˆ7-9-10', 'å€‹ä½ï¼š10 - 6 = 4', 'åä½ï¼š9 - 5 = 4', 'ç™¾ä½ï¼š7 - 3 = 4', 'ç­”æ¡ˆï¼š444'] },
                { q: '199 + 1 = ?', a: '200', opts: ['199', '200', '201', '210'], hint: 'é€²ä½è®Šæˆ200', steps: ['å€‹ä½ï¼š9 + 1 = 10ï¼ˆé€²ä½ï¼‰', 'åä½ï¼š9 + 1 = 10ï¼ˆé€²ä½ï¼‰', 'ç™¾ä½ï¼š1 + 1 = 2', 'ç­”æ¡ˆï¼š200'] },
                { q: '1000 - 1 = ?', a: '999', opts: ['899', '989', '999', '1001'], hint: 'å€Ÿä½è¨ˆç®—', steps: ['1000 å¾€ä¸‹æ•¸ 1', 'å°±æ˜¯ 999'] },
                { q: '456 + 544 = ?', a: '1000', opts: ['900', '990', '1000', '1010'], hint: 'å‰›å¥½æ¹Šæˆ1000', steps: ['å€‹ä½ï¼š6 + 4 = 10ï¼ˆé€²ä½ï¼‰', 'åä½ï¼š5 + 4 + 1 = 10ï¼ˆé€²ä½ï¼‰', 'ç™¾ä½ï¼š4 + 5 + 1 = 10ï¼ˆé€²ä½ï¼‰', 'ç­”æ¡ˆï¼š1000'] },
                { q: '503 - 247 = ?', a: '256', opts: ['246', '256', '266', '356'], hint: 'å€‹ä½3ä¸å¤ æ¸›7è¦å€Ÿä½', steps: ['å€‹ä½ï¼š13 - 7 = 6ï¼ˆå€Ÿä½ï¼‰', 'åä½ï¼š9 - 4 = 5ï¼ˆè¢«å€Ÿèµ°1ï¼‰', 'ç™¾ä½ï¼š4 - 2 = 2', 'ç­”æ¡ˆï¼š256'] },
                { q: '275 + 325 = ?', a: '600', opts: ['500', '590', '600', '610'], hint: 'å…©æ•¸ç›¸åŠ å‰›å¥½600', steps: ['å€‹ä½ï¼š5 + 5 = 10ï¼ˆé€²ä½ï¼‰', 'åä½ï¼š7 + 2 + 1 = 10ï¼ˆé€²ä½ï¼‰', 'ç™¾ä½ï¼š2 + 3 + 1 = 6', 'ç­”æ¡ˆï¼š600'] },
                { q: '702 - 458 = ?', a: '244', opts: ['234', '244', '254', '344'], hint: '0è¦å€Ÿä½è®Šæˆ10', steps: ['å€‹ä½ï¼š12 - 8 = 4ï¼ˆå€Ÿä½ï¼‰', 'åä½ï¼š9 - 5 = 4ï¼ˆå€Ÿä½å¾Œè¢«å€Ÿï¼‰', 'ç™¾ä½ï¼š6 - 4 = 2', 'ç­”æ¡ˆï¼š244'] }
            ],
            multiply: [
                { q: '6 Ã— 7 = ?', a: '42', opts: ['36', '42', '48', '49'], hint: 'å…­ä¸ƒå››åäºŒ', steps: ['èƒŒèª¦ï¼šå…­ä¸ƒå››åäºŒ', '6 Ã— 7 = 42'] },
                { q: '8 Ã— 9 = ?', a: '72', opts: ['63', '72', '81', '89'], hint: 'å…«ä¹ä¸ƒåäºŒ', steps: ['èƒŒèª¦ï¼šå…«ä¹ä¸ƒåäºŒ', '8 Ã— 9 = 72'] },
                { q: '9 Ã— 6 = ?', a: '54', opts: ['45', '54', '56', '63'], hint: 'ä¹å…­äº”åå››', steps: ['èƒŒèª¦ï¼šä¹å…­äº”åå››', '9 Ã— 6 = 54'] },
                { q: 'ä¸€é€±7å¤©ï¼Œ3é€±æœ‰å¹¾å¤©ï¼Ÿ', a: '21', opts: ['18', '21', '24', '28'], hint: '7 Ã— 3', steps: ['ä¸€é€± = 7å¤©', '3é€± = 7 Ã— 3 = 21å¤©'] },
                { q: '7 Ã— 7 = ?', a: '49', opts: ['42', '47', '49', '56'], hint: 'ä¸ƒä¸ƒå››åä¹', steps: ['èƒŒèª¦ï¼šä¸ƒä¸ƒå››åä¹', '7 Ã— 7 = 49'] },
                { q: 'ä¸€æ‰“12å€‹ï¼Œ3æ‰“æœ‰å¹¾å€‹ï¼Ÿ', a: '36', opts: ['32', '34', '36', '38'], hint: '12 Ã— 3', steps: ['ä¸€æ‰“ = 12å€‹', '3æ‰“ = 12 Ã— 3 = 36å€‹'] },
                { q: '5 Ã— 8 = ?', a: '40', opts: ['35', '40', '45', '48'], hint: 'äº”å…«å››å', steps: ['èƒŒèª¦ï¼šäº”å…«å››å', '5 Ã— 8 = 40'] },
                { q: '15 Ã— 3 = ?', a: '45', opts: ['35', '40', '45', '50'], hint: '10Ã—3=30ï¼Œ5Ã—3=15', steps: ['æ‹†é–‹ç®—ï¼š15 = 10 + 5', '10 Ã— 3 = 30', '5 Ã— 3 = 15', '30 + 15 = 45'] },
                { q: 'æ¯äºº4é¡†ç³–ï¼Œ9äººå…±å¹¾é¡†ï¼Ÿ', a: '36', opts: ['32', '36', '40', '45'], hint: '4 Ã— 9', steps: ['æ¯äºº4é¡† Ã— 9äºº', '4 Ã— 9 = 36é¡†'] },
                { q: '8 Ã— 8 = ?', a: '64', opts: ['56', '62', '64', '72'], hint: 'å…«å…«å…­åå››', steps: ['èƒŒèª¦ï¼šå…«å…«å…­åå››', '8 Ã— 8 = 64'] }
            ],
            divide: [
                { q: '18 Ã· 3 = ?', a: '6', opts: ['5', '6', '7', '8'], hint: '3 Ã— 6 = 18', steps: ['æƒ³ï¼š3 Ã— ? = 18', '3 Ã— 6 = 18', 'æ‰€ä»¥ 18 Ã· 3 = 6'] },
                { q: '35 Ã· 7 = ?', a: '5', opts: ['4', '5', '6', '7'], hint: '7 Ã— 5 = 35', steps: ['æƒ³ï¼š7 Ã— ? = 35', '7 Ã— 5 = 35', 'æ‰€ä»¥ 35 Ã· 7 = 5'] },
                { q: '48 Ã· 8 = ?', a: '6', opts: ['5', '6', '7', '8'], hint: '8 Ã— 6 = 48', steps: ['æƒ³ï¼š8 Ã— ? = 48', '8 Ã— 6 = 48', 'æ‰€ä»¥ 48 Ã· 8 = 6'] },
                { q: '36é¡†çƒåˆ†çµ¦9äººï¼Œæ¯äººå¹¾é¡†ï¼Ÿ', a: '4', opts: ['3', '4', '5', '6'], hint: '36 Ã· 9', steps: ['36é¡† Ã· 9äºº', 'æƒ³ï¼š9 Ã— ? = 36', '9 Ã— 4 = 36', 'æ¯äºº 4 é¡†'] },
                { q: '56 Ã· 7 = ?', a: '8', opts: ['6', '7', '8', '9'], hint: '7 Ã— 8 = 56', steps: ['æƒ³ï¼š7 Ã— ? = 56', '7 Ã— 8 = 56', 'æ‰€ä»¥ 56 Ã· 7 = 8'] },
                { q: '27 Ã· 3 = ?', a: '9', opts: ['7', '8', '9', '10'], hint: '3 Ã— 9 = 27', steps: ['æƒ³ï¼š3 Ã— ? = 27', '3 Ã— 9 = 27', 'æ‰€ä»¥ 27 Ã· 3 = 9'] },
                { q: '45é¡†ç³–åˆ†5è¢‹ï¼Œæ¯è¢‹å¹¾é¡†ï¼Ÿ', a: '9', opts: ['7', '8', '9', '10'], hint: '45 Ã· 5', steps: ['45é¡† Ã· 5è¢‹', 'æƒ³ï¼š5 Ã— ? = 45', '5 Ã— 9 = 45', 'æ¯è¢‹ 9 é¡†'] },
                { q: '23 Ã· 4 = ?...?', a: '5...3', opts: ['5...2', '5...3', '6...1', '6...2'], hint: '4Ã—5=20ï¼Œé¤˜3', steps: ['4 Ã— 5 = 20', '4 Ã— 6 = 24ï¼ˆå¤ªå¤§äº†ï¼‰', '23 - 20 = 3ï¼ˆé¤˜æ•¸ï¼‰', 'ç­”æ¡ˆï¼š5...3'] },
                { q: '64 Ã· 8 = ?', a: '8', opts: ['6', '7', '8', '9'], hint: '8 Ã— 8 = 64', steps: ['æƒ³ï¼š8 Ã— ? = 64', '8 Ã— 8 = 64', 'æ‰€ä»¥ 64 Ã· 8 = 8'] },
                { q: '50 Ã· 6 = ?...?', a: '8...2', opts: ['8...1', '8...2', '7...8', '9...2'], hint: '6Ã—8=48ï¼Œé¤˜2', steps: ['6 Ã— 8 = 48', '6 Ã— 9 = 54ï¼ˆå¤ªå¤§äº†ï¼‰', '50 - 48 = 2ï¼ˆé¤˜æ•¸ï¼‰', 'ç­”æ¡ˆï¼š8...2'] }
            ],
            shapes: [
                { q: 'ä¸‰è§’å½¢æœ‰å¹¾æ¢é‚Šï¼Ÿ', a: '3', opts: ['2', '3', '4', '5'], hint: 'ä¸‰è§’å½¢æœ‰3æ¢é‚Š', steps: ['ä¸‰è§’å½¢ = 3å€‹è§’', 'ä¹Ÿæœ‰ 3 æ¢é‚Š'] },
                { q: 'æ­£æ–¹å½¢é‚Šé•·4cmï¼Œå‘¨é•·ï¼Ÿ', a: '16cm', opts: ['12cm', '14cm', '16cm', '20cm'], hint: '4 Ã— 4', steps: ['æ­£æ–¹å½¢4é‚Šä¸€æ¨£é•·', 'å‘¨é•· = é‚Šé•· Ã— 4', '= 4 Ã— 4 = 16cm'] },
                { q: 'é•·æ–¹å½¢é•·6cmå¯¬4cmï¼Œå‘¨é•·ï¼Ÿ', a: '20cm', opts: ['18cm', '20cm', '22cm', '24cm'], hint: '(6+4) Ã— 2', steps: ['é•·æ–¹å½¢å‘¨é•· = (é•·+å¯¬) Ã— 2', '= (6 + 4) Ã— 2', '= 10 Ã— 2 = 20cm'] },
                { q: 'å“ªå€‹åœ–å½¢å››é‚Šä¸€æ¨£é•·ï¼Ÿ', a: 'æ­£æ–¹å½¢', opts: ['ä¸‰è§’å½¢', 'æ­£æ–¹å½¢', 'é•·æ–¹å½¢', 'æ¢¯å½¢'], hint: 'æ­£æ–¹å½¢å››é‚Šç­‰é•·', steps: ['æ­£æ–¹å½¢çš„ç‰¹æ€§ï¼š', 'å››æ¢é‚Šä¸€æ¨£é•·', 'å››å€‹è§’éƒ½æ˜¯ç›´è§’'] },
                { q: 'åœ“å½¢æœ‰å¹¾å€‹è§’ï¼Ÿ', a: '0', opts: ['0', '1', '2', '4'], hint: 'åœ“å½¢æ²’æœ‰è§’', steps: ['åœ“å½¢æ˜¯åœ“æ»‘çš„æ›²ç·š', 'æ²’æœ‰å°–å°–çš„è§’', 'æ‰€ä»¥æ˜¯ 0 å€‹è§’'] },
                { q: 'æ­£ä¸‰è§’å½¢é‚Šé•·3cmï¼Œå‘¨é•·ï¼Ÿ', a: '9cm', opts: ['6cm', '9cm', '12cm', '15cm'], hint: '3 Ã— 3', steps: ['æ­£ä¸‰è§’å½¢3é‚Šä¸€æ¨£é•·', 'å‘¨é•· = é‚Šé•· Ã— 3', '= 3 Ã— 3 = 9cm'] },
                { q: 'é•·æ–¹å½¢æœ‰å¹¾çµ„å°é‚Šä¸€æ¨£é•·ï¼Ÿ', a: '2çµ„', opts: ['1çµ„', '2çµ„', '3çµ„', '4çµ„'], hint: 'ä¸Šä¸‹ä¸€çµ„ï¼Œå·¦å³ä¸€çµ„', steps: ['é•·æ–¹å½¢ï¼š', 'ä¸Šé‚Š = ä¸‹é‚Šï¼ˆ1çµ„ï¼‰', 'å·¦é‚Š = å³é‚Šï¼ˆ1çµ„ï¼‰', 'å…± 2 çµ„'] },
                { q: 'æ­£æ–¹å½¢é‚Šé•·8cmï¼Œå‘¨é•·ï¼Ÿ', a: '32cm', opts: ['24cm', '28cm', '32cm', '36cm'], hint: '8 Ã— 4', steps: ['æ­£æ–¹å½¢å‘¨é•· = é‚Šé•· Ã— 4', '= 8 Ã— 4 = 32cm'] },
                { q: 'å“ªå€‹åœ–å½¢åªæœ‰3å€‹è§’ï¼Ÿ', a: 'ä¸‰è§’å½¢', opts: ['ä¸‰è§’å½¢', 'æ­£æ–¹å½¢', 'åœ“å½¢', 'é•·æ–¹å½¢'], hint: 'ä¸‰è§’ = 3å€‹è§’', steps: ['ä¸‰è§’å½¢çš„ã€Œä¸‰ã€', 'å°±æ˜¯æŒ‡ 3 å€‹è§’'] },
                { q: 'é•·æ–¹å½¢é•·10cmå¯¬5cmï¼Œå‘¨é•·ï¼Ÿ', a: '30cm', opts: ['25cm', '30cm', '35cm', '40cm'], hint: '(10+5) Ã— 2', steps: ['é•·æ–¹å½¢å‘¨é•· = (é•·+å¯¬) Ã— 2', '= (10 + 5) Ã— 2', '= 15 Ã— 2 = 30cm'] }
            ],
            time: [
                { q: 'ä¸€å°æ™‚æœ‰å¹¾åˆ†é˜ï¼Ÿ', a: '60', opts: ['30', '50', '60', '100'], hint: '1å°æ™‚ = 60åˆ†é˜', steps: ['1å°æ™‚ = 60åˆ†é˜', 'é€™æ˜¯å›ºå®šçš„æ›ç®—'] },
                { q: '8:45å†é30åˆ†é˜æ˜¯ï¼Ÿ', a: '9:15', opts: ['9:00', '9:15', '9:30', '9:45'], hint: '45+30=75ï¼Œé€²1å°æ™‚', steps: ['45 + 30 = 75åˆ†é˜', '75åˆ†é˜ = 1å°æ™‚15åˆ†', '8é» + 1å°æ™‚ = 9é»', 'ç­”æ¡ˆï¼š9:15'] },
                { q: 'ä¸€å¤©æœ‰å¹¾å°æ™‚ï¼Ÿ', a: '24', opts: ['12', '20', '24', '30'], hint: '1å¤© = 24å°æ™‚', steps: ['1å¤© = 24å°æ™‚', 'ç™½å¤©12å°æ™‚ + æ™šä¸Š12å°æ™‚'] },
                { q: '3æœˆæœ‰å¹¾å¤©ï¼Ÿ', a: '31', opts: ['28', '30', '31', '32'], hint: '3æœˆæœ‰31å¤©', steps: ['å¤§æœˆæœ‰31å¤©ï¼š', '1ã€3ã€5ã€7ã€8ã€10ã€12æœˆ', '3æœˆæ˜¯å¤§æœˆï¼Œæœ‰31å¤©'] },
                { q: '2å…¬å‡ = å¹¾æ¯«å‡ï¼Ÿ', a: '2000', opts: ['200', '1000', '2000', '20000'], hint: '1å…¬å‡ = 1000æ¯«å‡', steps: ['1å…¬å‡ = 1000æ¯«å‡', '2å…¬å‡ = 2 Ã— 1000', '= 2000æ¯«å‡'] },
                { q: '10:20å†é40åˆ†é˜æ˜¯ï¼Ÿ', a: '11:00', opts: ['10:60', '11:00', '11:10', '11:20'], hint: '20+40=60=1å°æ™‚', steps: ['20 + 40 = 60åˆ†é˜', '60åˆ†é˜ = 1å°æ™‚', '10é» + 1å°æ™‚ = 11:00'] },
                { q: 'ä¸€é€±æœ‰å¹¾å¤©ï¼Ÿ', a: '7', opts: ['5', '6', '7', '8'], hint: 'ä¸€é€± = 7å¤©', steps: ['ä¸€é€± = 7å¤©', 'æ˜ŸæœŸä¸€åˆ°æ˜ŸæœŸæ—¥'] },
                { q: '500æ¯«å‡ + 500æ¯«å‡ = ?', a: '1å…¬å‡', opts: ['100æ¯«å‡', '500æ¯«å‡', '1å…¬å‡', '10å…¬å‡'], hint: '1000æ¯«å‡ = 1å…¬å‡', steps: ['500 + 500 = 1000æ¯«å‡', '1000æ¯«å‡ = 1å…¬å‡'] },
                { q: 'ä¸‹åˆ3é»æ˜¯å¹¾é»ï¼Ÿï¼ˆ24æ™‚åˆ¶ï¼‰', a: '15é»', opts: ['3é»', '13é»', '15é»', '17é»'], hint: '12 + 3 = 15', steps: ['24æ™‚åˆ¶ï¼š', 'ä¸‹åˆè¦åŠ 12', '3 + 12 = 15é»'] },
                { q: '2å°æ™‚30åˆ† = å¹¾åˆ†é˜ï¼Ÿ', a: '150', opts: ['120', '130', '150', '180'], hint: '2Ã—60+30', steps: ['2å°æ™‚ = 2 Ã— 60 = 120åˆ†é˜', '120 + 30 = 150åˆ†é˜'] }
            ]
        };

        const levelNames = {
            numbers: 'æ•¸å­—æ˜Ÿçƒ',
            multiply: 'ä¹˜æ³•éŠ€æ²³',
            divide: 'é™¤æ³•é»‘æ´',
            shapes: 'åœ–å½¢å¤ªç©ºç«™',
            time: 'æ™‚é–“èŸ²æ´'
        };

        const levelIcons = {
            numbers: 'ğŸ”¢',
            multiply: 'âœ–ï¸',
            divide: 'â—',
            shapes: 'ğŸ“',
            time: 'â°'
        };

        const levelRequirements = {
            numbers: 0,
            multiply: 50,
            divide: 150,
            shapes: 300,
            time: 500
        };

        const levelTitles = ['æ•¸å­¸æ–°æ‰‹', 'æ˜Ÿéš›è¨ˆç®—å“¡', 'éŠ€æ²³æ•¸å­¸å®¶', 'å®‡å®™è§£é¡Œç‹', 'æ•¸å­¸å°åšå£«', 'æ•¸å­¸å¤ªç©ºäºº'];

        let gameState = {
            playerName: '',
            stars: 0,
            exp: 0,
            level: 1,
            currentLevel: null,
            currentQuestion: 0,
            correctAnswers: 0,
            lives: 3,
            records: [],
            levelProgress: { numbers: 0, multiply: 0, divide: 0, shapes: 0, time: 0 },
            questionResults: []
        };

        function loadGame() {
            const saved = localStorage.getItem('xiaoyongMathGame');
            if (saved) {
                gameState = JSON.parse(saved);
                document.getElementById('nameModal').classList.add('hidden');
                updateUI();
            }
        }

        function saveGame() {
            localStorage.setItem('xiaoyongMathGame', JSON.stringify(gameState));
        }

        function setPlayerName() {
            const name = document.getElementById('playerNameInput').value.trim();
            if (name) {
                playStartSound();
                gameState.playerName = name;
                document.getElementById('nameModal').classList.add('hidden');
                updateUI();
                saveGame();
            } else {
                alert('è«‹è¼¸å…¥ä½ çš„åå­—å–”ï¼');
            }
        }

        function updateUI() {
            document.getElementById('playerName').textContent = gameState.playerName || 'å°è›¹';
            document.getElementById('playerStars').textContent = gameState.stars;
            document.getElementById('playerExp').textContent = gameState.exp;
            document.getElementById('playerLevel').textContent = gameState.level;
            document.getElementById('levelTitle').textContent = levelTitles[Math.min(gameState.level - 1, levelTitles.length - 1)];
            updateLevelLocks();
            updateProgressBars();
            updateRecords();
        }

        function updateLevelLocks() {
            ['multiply', 'divide', 'shapes', 'time'].forEach(level => {
                const card = document.getElementById('level' + level.charAt(0).toUpperCase() + level.slice(1));
                const existingLock = card.querySelector('.lock-overlay');
                if (existingLock) existingLock.remove();
                
                if (gameState.exp < levelRequirements[level]) {
                    card.classList.add('locked');
                    const lockDiv = document.createElement('div');
                    lockDiv.className = 'lock-overlay';
                    lockDiv.textContent = 'ğŸ”’';
                    card.appendChild(lockDiv);
                } else {
                    card.classList.remove('locked');
                }
            });
        }

        function updateProgressBars() {
            Object.keys(gameState.levelProgress).forEach(level => {
                const bar = document.getElementById('progress' + level.charAt(0).toUpperCase() + level.slice(1));
                if (bar) bar.style.width = gameState.levelProgress[level] + '%';
            });
        }

        function updateRecords() {
            const recordsList = document.getElementById('recordsList');
            if (gameState.records.length === 0) {
                recordsList.innerHTML = '<div class="empty-records"><div class="empty-records-icon">ğŸ›¸</div><p>é‚„æ²’æœ‰ç´€éŒ„å–”ï¼å¿«ä¾†æ¢ç´¢æ˜Ÿçƒå§ï¼</p></div>';
            } else {
                recordsList.innerHTML = gameState.records.slice(-10).reverse().map(r => 
                    `<div class="record-item">
                        <div class="record-icon">${r.passed ? 'ğŸ†' : 'ğŸ“–'}</div>
                        <div class="record-info">
                            <div class="record-title">${levelNames[r.level]}</div>
                            <div class="record-date">${r.date}</div>
                        </div>
                        <div class="record-score">${r.score}/10</div>
                    </div>`
                ).join('');
            }
        }

        function startGame(level) {
            if (gameState.exp < levelRequirements[level]) {
                playWrongSound();
                alert(`éœ€è¦ ${levelRequirements[level]} ç¶“é©—å€¼æ‰èƒ½è§£é–ï¼\nç›®å‰ç¶“é©—å€¼ï¼š${gameState.exp}`);
                return;
            }

            playStartSound();
            gameState.currentLevel = level;
            gameState.currentQuestion = 0;
            gameState.correctAnswers = 0;
            gameState.lives = 3;
            gameState.questionResults = [];

            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';
            document.getElementById('resultScreen').style.display = 'none';
            document.getElementById('gameTitle').textContent = levelIcons[level] + ' ' + levelNames[level];

            showQuestion();
        }

        function showQuestion() {
            const qData = questions[gameState.currentLevel][gameState.currentQuestion];
            
            document.getElementById('questionNum').textContent = gameState.currentQuestion + 1;
            document.getElementById('questionImage').textContent = levelIcons[gameState.currentLevel];
            document.getElementById('questionText').textContent = qData.q;
            document.getElementById('questionHint').textContent = 'ğŸ’¡ æç¤ºï¼š' + qData.hint;
            
            let hearts = '';
            for (let i = 0; i < gameState.lives; i++) hearts += 'ğŸ’œ';
            for (let i = gameState.lives; i < 3; i++) hearts += 'ğŸ–¤';
            document.getElementById('energyHearts').textContent = hearts;

            const shuffled = qData.opts.slice().sort(() => Math.random() - 0.5);
            const grid = document.getElementById('answersGrid');
            grid.innerHTML = '';
            shuffled.forEach(opt => {
                const btn = document.createElement('button');
                btn.className = 'answer-btn';
                btn.textContent = opt;
                btn.onclick = () => checkAnswer(opt);
                grid.appendChild(btn);
            });
        }

        function checkAnswer(selected) {
            const qData = questions[gameState.currentLevel][gameState.currentQuestion];
            const isCorrect = selected === qData.a;
            const buttons = document.querySelectorAll('.answer-btn');
            
            buttons.forEach(btn => {
                btn.disabled = true;
                if (btn.textContent === qData.a) btn.classList.add('correct');
                if (btn.textContent === selected && !isCorrect) btn.classList.add('wrong');
            });

            gameState.questionResults.push({
                question: qData.q,
                answer: qData.a,
                hint: qData.hint,
                steps: qData.steps,
                userAnswer: selected,
                isCorrect: isCorrect
            });

            if (isCorrect) {
                gameState.correctAnswers++;
                playCorrectSound();
                setTimeout(() => proceedToNext(), 800);
            } else {
                gameState.lives--;
                playWrongSound();
                setTimeout(() => showWrongFeedback(qData, selected), 600);
            }
        }

        function showWrongFeedback(qData, userAnswer) {
            const stepsHtml = qData.steps.map(s => `<div class="feedback-step">${s}</div>`).join('');
            const html = `
                <div class="wrong-feedback" id="wrongFeedback">
                    <div class="feedback-card">
                        <div class="feedback-icon">ğŸ¤”</div>
                        <div class="feedback-title">è®“æˆ‘å€‘ä¸€èµ·æƒ³ä¸€æƒ³ï¼</div>
                        <div class="feedback-content">
                            <div class="feedback-question">${qData.q}</div>
                            <div class="feedback-answer">âœ¨ ${qData.a} âœ¨</div>
                            <div class="feedback-steps">
                                <div class="feedback-steps-title">ğŸ“ è§£é¡Œæ­¥é©Ÿï¼š</div>
                                ${stepsHtml}
                            </div>
                            <div class="feedback-hint">ğŸ’¡ ${qData.hint}</div>
                        </div>
                        <div class="feedback-your-answer">ä½ çš„ç­”æ¡ˆï¼š<span>${userAnswer}</span></div>
                        <button class="feedback-btn" onclick="closeFeedbackAndProceed()">æˆ‘æ‡‚äº†ï¼ç¹¼çºŒ â†’</button>
                    </div>
                </div>
            `;
            document.body.insertAdjacentHTML('beforeend', html);
        }

        function closeFeedbackAndProceed() {
            const feedback = document.getElementById('wrongFeedback');
            if (feedback) feedback.remove();
            playClickSound();
            proceedToNext();
        }

        function proceedToNext() {
            if (gameState.lives === 0 || gameState.currentQuestion >= 9) {
                showResult();
            } else {
                gameState.currentQuestion++;
                showQuestion();
            }
        }

        function showResult() {
            const passed = gameState.correctAnswers >= 6;
            const starsEarned = gameState.correctAnswers * 10;
            const expEarned = gameState.correctAnswers * 5;

            if (passed) playWinSound(); else playLoseSound();

            gameState.stars += starsEarned;
            gameState.exp += expEarned;
            gameState.level = Math.floor(gameState.exp / 100) + 1;
            gameState.levelProgress[gameState.currentLevel] = Math.max(
                gameState.levelProgress[gameState.currentLevel],
                gameState.correctAnswers * 10
            );

            const now = new Date();
            gameState.records.push({
                level: gameState.currentLevel,
                score: gameState.correctAnswers,
                passed: passed,
                date: `${now.getFullYear()}/${now.getMonth() + 1}/${now.getDate()}`
            });

            saveGame();

            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'block';

            document.getElementById('resultIcon').textContent = passed ? 'ğŸ¦‹' : 'ğŸ›';
            document.getElementById('resultTitle').textContent = passed ? 'å¤ªå²å®³äº†ï¼' : 'ç¹¼çºŒåŠ æ²¹ï¼';
            document.getElementById('resultTitle').className = 'result-title ' + (passed ? 'success' : 'fail');
            document.getElementById('resultMessage').textContent = passed ? 
                'ä½ æˆåŠŸå¾æœäº†é€™å€‹æ˜Ÿçƒï¼' : 'å†ç·´ç¿’ä¸€ä¸‹ï¼Œå°è›¹ä¸€å®šå¯ä»¥çš„ï¼';
            document.getElementById('resultCorrect').textContent = gameState.correctAnswers;
            document.getElementById('resultStars').textContent = '+' + starsEarned;
            document.getElementById('resultExp').textContent = '+' + expEarned;

            generateReviewList();
        }

        function generateReviewList() {
            const list = document.getElementById('reviewList');
            const wrong = gameState.questionResults.filter(q => !q.isCorrect);
            const correct = gameState.questionResults.filter(q => q.isCorrect);
            
            let html = '';
            
            if (wrong.length > 0) {
                html += '<div style="color: #EF4444; font-weight: 800; margin-bottom: 10px;">âŒ éœ€è¦åŠ å¼·ï¼š</div>';
                wrong.forEach(q => {
                    html += `
                        <div class="review-item wrong">
                            <div class="review-emoji">ğŸ“</div>
                            <div class="review-content">
                                <div class="review-question">${q.question}</div>
                                <div class="review-answer">æ­£ç¢ºç­”æ¡ˆï¼š${q.answer}</div>
                                <div class="review-your-answer">ä½ çš„ç­”æ¡ˆï¼š${q.userAnswer}</div>
                            </div>
                            <div class="review-status">ğŸ”„</div>
                        </div>
                    `;
                });
            }
            
            if (correct.length > 0) {
                html += '<div style="color: #22C55E; font-weight: 800; margin: 15px 0 10px;">âœ… ç­”å°çš„é¡Œç›®ï¼š</div>';
                correct.forEach(q => {
                    html += `
                        <div class="review-item correct">
                            <div class="review-emoji">âœ¨</div>
                            <div class="review-content">
                                <div class="review-question">${q.question}</div>
                                <div class="review-answer">ç­”æ¡ˆï¼š${q.answer}</div>
                            </div>
                            <div class="review-status">â­</div>
                        </div>
                    `;
                });
            }
            
            list.innerHTML = html;
        }

        function restartGame() {
            playClickSound();
            startGame(gameState.currentLevel);
        }

        function backToMain() {
            playClickSound();
            document.getElementById('mainScreen').style.display = 'block';
            document.getElementById('gameArea').style.display = 'none';
            document.getElementById('resultScreen').style.display = 'none';
            updateUI();
        }

        loadGame();

        document.getElementById('playerNameInput').addEventListener('keypress', e => {
            if (e.key === 'Enter') setPlayerName();
        });
    </script>
</body>
</html>
